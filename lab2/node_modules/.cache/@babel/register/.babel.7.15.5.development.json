{
  "{\"assumptions\":{},\"sourceRoot\":\"/home/vinah331/Desktop/tdp013/lab2/\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"/home/vinah331/Desktop/tdp013/lab2\",\"filename\":\"/home/vinah331/Desktop/tdp013/lab2/app.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/home/vinah331/Desktop/tdp013/lab2\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.15.5": {
    "metadata": {},
    "options": {
      "assumptions": {},
      "sourceRoot": "/home/vinah331/Desktop/tdp013/lab2/",
      "caller": {
        "name": "@babel/node"
      },
      "cwd": "/home/vinah331/Desktop/tdp013/lab2",
      "filename": "/home/vinah331/Desktop/tdp013/lab2/app.js",
      "targets": {},
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "browserslistConfigFile": false,
      "envName": "development",
      "root": "/home/vinah331/Desktop/tdp013/lab2",
      "rootMode": "root",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/home/vinah331/Desktop/tdp013/lab2/app.js",
        "plugins": []
      },
      "generatorOpts": {
        "filename": "/home/vinah331/Desktop/tdp013/lab2/app.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/home/vinah331/Desktop/tdp013/lab2/",
        "sourceFileName": "app.js"
      }
    },
    "ast": null,
    "code": "var createError = require('http-errors');\n\nvar express = require('express');\n\nvar path = require('path');\n\nvar cookieParser = require('cookie-parser');\n\nvar logger = require('morgan');\n\nvar indexRouter = require('./routes/index');\n\nvar usersRouter = require('./routes/users');\n\nvar app = express(); // view engine setup\n\napp.set('views', path.join(__dirname, 'views'));\napp.set('view engine', 'jade');\napp.use(logger('dev'));\napp.use(express.json());\napp.use(express.urlencoded({\n  extended: false\n}));\napp.use(cookieParser());\napp.use(express.static(path.join(__dirname, 'public')));\napp.use('/', indexRouter);\napp.use('/users', usersRouter); // catch 404 and forward to error handler\n\napp.use(function (req, res, next) {\n  next(createError(404));\n}); // error handler\n// app.use(function(err, req, res, next) {\n//   // set locals, only providing error in development\n//   res.locals.message = err.message;\n//   res.locals.error = req.app.get('env') === 'development' ? err : {};\n//   // render the error page\n//   res.status(err.status || 500);\n//   res.render('error');\n// });\n\nconst {\n  MongoClient\n} = require('mongodb');\n\nlet url = \"mongodb://localhost:27017/\";\n\nfunction startServer(port) {\n  let server = app.listen(8888, () => {\n    let host = server.address().address;\n    let port = server.address().port;\n    console.log(`Lyssnar på http://${host}:${port}`);\n  });\n  return server;\n}\n/*\nlet server = app.listen(8888, () => {\n let host = server.address().address\n let port = server.address().port\n console.log(`Lyssnar på http://${host}:${port}`)\n})*/\n\n\nstartServer();\nmodule.exports = startServer;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJjcmVhdGVFcnJvciIsInJlcXVpcmUiLCJleHByZXNzIiwicGF0aCIsImNvb2tpZVBhcnNlciIsImxvZ2dlciIsImluZGV4Um91dGVyIiwidXNlcnNSb3V0ZXIiLCJhcHAiLCJzZXQiLCJqb2luIiwiX19kaXJuYW1lIiwidXNlIiwianNvbiIsInVybGVuY29kZWQiLCJleHRlbmRlZCIsInN0YXRpYyIsInJlcSIsInJlcyIsIm5leHQiLCJNb25nb0NsaWVudCIsInVybCIsInN0YXJ0U2VydmVyIiwicG9ydCIsInNlcnZlciIsImxpc3RlbiIsImhvc3QiLCJhZGRyZXNzIiwiY29uc29sZSIsImxvZyIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQUFBLElBQUlBLFdBQVcsR0FBR0MsT0FBTyxDQUFDLGFBQUQsQ0FBekI7O0FBQ0EsSUFBSUMsT0FBTyxHQUFHRCxPQUFPLENBQUMsU0FBRCxDQUFyQjs7QUFDQSxJQUFJRSxJQUFJLEdBQUdGLE9BQU8sQ0FBQyxNQUFELENBQWxCOztBQUNBLElBQUlHLFlBQVksR0FBR0gsT0FBTyxDQUFDLGVBQUQsQ0FBMUI7O0FBQ0EsSUFBSUksTUFBTSxHQUFHSixPQUFPLENBQUMsUUFBRCxDQUFwQjs7QUFFQSxJQUFJSyxXQUFXLEdBQUdMLE9BQU8sQ0FBQyxnQkFBRCxDQUF6Qjs7QUFDQSxJQUFJTSxXQUFXLEdBQUdOLE9BQU8sQ0FBQyxnQkFBRCxDQUF6Qjs7QUFFQSxJQUFJTyxHQUFHLEdBQUdOLE9BQU8sRUFBakIsQyxDQUVBOztBQUNBTSxHQUFHLENBQUNDLEdBQUosQ0FBUSxPQUFSLEVBQWlCTixJQUFJLENBQUNPLElBQUwsQ0FBVUMsU0FBVixFQUFxQixPQUFyQixDQUFqQjtBQUNBSCxHQUFHLENBQUNDLEdBQUosQ0FBUSxhQUFSLEVBQXVCLE1BQXZCO0FBRUFELEdBQUcsQ0FBQ0ksR0FBSixDQUFRUCxNQUFNLENBQUMsS0FBRCxDQUFkO0FBQ0FHLEdBQUcsQ0FBQ0ksR0FBSixDQUFRVixPQUFPLENBQUNXLElBQVIsRUFBUjtBQUNBTCxHQUFHLENBQUNJLEdBQUosQ0FBUVYsT0FBTyxDQUFDWSxVQUFSLENBQW1CO0FBQUVDLEVBQUFBLFFBQVEsRUFBRTtBQUFaLENBQW5CLENBQVI7QUFDQVAsR0FBRyxDQUFDSSxHQUFKLENBQVFSLFlBQVksRUFBcEI7QUFDQUksR0FBRyxDQUFDSSxHQUFKLENBQVFWLE9BQU8sQ0FBQ2MsTUFBUixDQUFlYixJQUFJLENBQUNPLElBQUwsQ0FBVUMsU0FBVixFQUFxQixRQUFyQixDQUFmLENBQVI7QUFFQUgsR0FBRyxDQUFDSSxHQUFKLENBQVEsR0FBUixFQUFhTixXQUFiO0FBQ0FFLEdBQUcsQ0FBQ0ksR0FBSixDQUFRLFFBQVIsRUFBa0JMLFdBQWxCLEUsQ0FHQTs7QUFDQUMsR0FBRyxDQUFDSSxHQUFKLENBQVEsVUFBU0ssR0FBVCxFQUFjQyxHQUFkLEVBQW1CQyxJQUFuQixFQUF5QjtBQUMvQkEsRUFBQUEsSUFBSSxDQUFDbkIsV0FBVyxDQUFDLEdBQUQsQ0FBWixDQUFKO0FBQ0QsQ0FGRCxFLENBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUdBLE1BQU07QUFBQ29CLEVBQUFBO0FBQUQsSUFBZ0JuQixPQUFPLENBQUMsU0FBRCxDQUE3Qjs7QUFDQSxJQUFJb0IsR0FBRyxHQUFHLDRCQUFWOztBQUdBLFNBQVNDLFdBQVQsQ0FBcUJDLElBQXJCLEVBQTJCO0FBQ3pCLE1BQUlDLE1BQU0sR0FBR2hCLEdBQUcsQ0FBQ2lCLE1BQUosQ0FBVyxJQUFYLEVBQWlCLE1BQU07QUFDbEMsUUFBSUMsSUFBSSxHQUFHRixNQUFNLENBQUNHLE9BQVAsR0FBaUJBLE9BQTVCO0FBQ0EsUUFBSUosSUFBSSxHQUFHQyxNQUFNLENBQUNHLE9BQVAsR0FBaUJKLElBQTVCO0FBQ0FLLElBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFhLHFCQUFvQkgsSUFBSyxJQUFHSCxJQUFLLEVBQTlDO0FBQ0EsR0FKVyxDQUFiO0FBS0EsU0FBT0MsTUFBUDtBQUNEO0FBQUE7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQ0YsV0FBVztBQUVYUSxNQUFNLENBQUNDLE9BQVAsR0FBaUJULFdBQWpCIiwic291cmNlUm9vdCI6Ii9ob21lL3ZpbmFoMzMxL0Rlc2t0b3AvdGRwMDEzL2xhYjIvIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGNyZWF0ZUVycm9yID0gcmVxdWlyZSgnaHR0cC1lcnJvcnMnKTtcbnZhciBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xudmFyIHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG52YXIgY29va2llUGFyc2VyID0gcmVxdWlyZSgnY29va2llLXBhcnNlcicpO1xudmFyIGxvZ2dlciA9IHJlcXVpcmUoJ21vcmdhbicpO1xuXG52YXIgaW5kZXhSb3V0ZXIgPSByZXF1aXJlKCcuL3JvdXRlcy9pbmRleCcpO1xudmFyIHVzZXJzUm91dGVyID0gcmVxdWlyZSgnLi9yb3V0ZXMvdXNlcnMnKTtcblxudmFyIGFwcCA9IGV4cHJlc3MoKTtcblxuLy8gdmlldyBlbmdpbmUgc2V0dXBcbmFwcC5zZXQoJ3ZpZXdzJywgcGF0aC5qb2luKF9fZGlybmFtZSwgJ3ZpZXdzJykpO1xuYXBwLnNldCgndmlldyBlbmdpbmUnLCAnamFkZScpO1xuXG5hcHAudXNlKGxvZ2dlcignZGV2JykpO1xuYXBwLnVzZShleHByZXNzLmpzb24oKSk7XG5hcHAudXNlKGV4cHJlc3MudXJsZW5jb2RlZCh7IGV4dGVuZGVkOiBmYWxzZSB9KSk7XG5hcHAudXNlKGNvb2tpZVBhcnNlcigpKTtcbmFwcC51c2UoZXhwcmVzcy5zdGF0aWMocGF0aC5qb2luKF9fZGlybmFtZSwgJ3B1YmxpYycpKSk7XG5cbmFwcC51c2UoJy8nLCBpbmRleFJvdXRlcik7XG5hcHAudXNlKCcvdXNlcnMnLCB1c2Vyc1JvdXRlcik7XG5cblxuLy8gY2F0Y2ggNDA0IGFuZCBmb3J3YXJkIHRvIGVycm9yIGhhbmRsZXJcbmFwcC51c2UoZnVuY3Rpb24ocmVxLCByZXMsIG5leHQpIHtcbiAgbmV4dChjcmVhdGVFcnJvcig0MDQpKTtcbn0pO1xuXG4vLyBlcnJvciBoYW5kbGVyXG4vLyBhcHAudXNlKGZ1bmN0aW9uKGVyciwgcmVxLCByZXMsIG5leHQpIHtcbi8vICAgLy8gc2V0IGxvY2Fscywgb25seSBwcm92aWRpbmcgZXJyb3IgaW4gZGV2ZWxvcG1lbnRcbi8vICAgcmVzLmxvY2Fscy5tZXNzYWdlID0gZXJyLm1lc3NhZ2U7XG4vLyAgIHJlcy5sb2NhbHMuZXJyb3IgPSByZXEuYXBwLmdldCgnZW52JykgPT09ICdkZXZlbG9wbWVudCcgPyBlcnIgOiB7fTtcblxuLy8gICAvLyByZW5kZXIgdGhlIGVycm9yIHBhZ2Vcbi8vICAgcmVzLnN0YXR1cyhlcnIuc3RhdHVzIHx8IDUwMCk7XG4vLyAgIHJlcy5yZW5kZXIoJ2Vycm9yJyk7XG4vLyB9KTtcblxuXG5jb25zdCB7TW9uZ29DbGllbnR9ID0gcmVxdWlyZSgnbW9uZ29kYicpO1xubGV0IHVybCA9IFwibW9uZ29kYjovL2xvY2FsaG9zdDoyNzAxNy9cIjtcblxuXG5mdW5jdGlvbiBzdGFydFNlcnZlcihwb3J0KSB7XG4gIGxldCBzZXJ2ZXIgPSBhcHAubGlzdGVuKDg4ODgsICgpID0+IHtcbiAgICBsZXQgaG9zdCA9IHNlcnZlci5hZGRyZXNzKCkuYWRkcmVzc1xuICAgIGxldCBwb3J0ID0gc2VydmVyLmFkZHJlc3MoKS5wb3J0XG4gICAgY29uc29sZS5sb2coYEx5c3NuYXIgcMOlIGh0dHA6Ly8ke2hvc3R9OiR7cG9ydH1gKVxuICAgfSlcbiAgcmV0dXJuKHNlcnZlcilcbn0vKlxubGV0IHNlcnZlciA9IGFwcC5saXN0ZW4oODg4OCwgKCkgPT4ge1xuICBsZXQgaG9zdCA9IHNlcnZlci5hZGRyZXNzKCkuYWRkcmVzc1xuICBsZXQgcG9ydCA9IHNlcnZlci5hZGRyZXNzKCkucG9ydFxuICBjb25zb2xlLmxvZyhgTHlzc25hciBww6UgaHR0cDovLyR7aG9zdH06JHtwb3J0fWApXG4gfSkqL1xuXG4gc3RhcnRTZXJ2ZXIoKVxuXG4gbW9kdWxlLmV4cG9ydHMgPSBzdGFydFNlcnZlcjsiXX0=",
    "map": {
      "version": 3,
      "sources": [
        "app.js"
      ],
      "names": [
        "createError",
        "require",
        "express",
        "path",
        "cookieParser",
        "logger",
        "indexRouter",
        "usersRouter",
        "app",
        "set",
        "join",
        "__dirname",
        "use",
        "json",
        "urlencoded",
        "extended",
        "static",
        "req",
        "res",
        "next",
        "MongoClient",
        "url",
        "startServer",
        "port",
        "server",
        "listen",
        "host",
        "address",
        "console",
        "log",
        "module",
        "exports"
      ],
      "mappings": "AAAA,IAAIA,WAAW,GAAGC,OAAO,CAAC,aAAD,CAAzB;;AACA,IAAIC,OAAO,GAAGD,OAAO,CAAC,SAAD,CAArB;;AACA,IAAIE,IAAI,GAAGF,OAAO,CAAC,MAAD,CAAlB;;AACA,IAAIG,YAAY,GAAGH,OAAO,CAAC,eAAD,CAA1B;;AACA,IAAII,MAAM,GAAGJ,OAAO,CAAC,QAAD,CAApB;;AAEA,IAAIK,WAAW,GAAGL,OAAO,CAAC,gBAAD,CAAzB;;AACA,IAAIM,WAAW,GAAGN,OAAO,CAAC,gBAAD,CAAzB;;AAEA,IAAIO,GAAG,GAAGN,OAAO,EAAjB,C,CAEA;;AACAM,GAAG,CAACC,GAAJ,CAAQ,OAAR,EAAiBN,IAAI,CAACO,IAAL,CAAUC,SAAV,EAAqB,OAArB,CAAjB;AACAH,GAAG,CAACC,GAAJ,CAAQ,aAAR,EAAuB,MAAvB;AAEAD,GAAG,CAACI,GAAJ,CAAQP,MAAM,CAAC,KAAD,CAAd;AACAG,GAAG,CAACI,GAAJ,CAAQV,OAAO,CAACW,IAAR,EAAR;AACAL,GAAG,CAACI,GAAJ,CAAQV,OAAO,CAACY,UAAR,CAAmB;AAAEC,EAAAA,QAAQ,EAAE;AAAZ,CAAnB,CAAR;AACAP,GAAG,CAACI,GAAJ,CAAQR,YAAY,EAApB;AACAI,GAAG,CAACI,GAAJ,CAAQV,OAAO,CAACc,MAAR,CAAeb,IAAI,CAACO,IAAL,CAAUC,SAAV,EAAqB,QAArB,CAAf,CAAR;AAEAH,GAAG,CAACI,GAAJ,CAAQ,GAAR,EAAaN,WAAb;AACAE,GAAG,CAACI,GAAJ,CAAQ,QAAR,EAAkBL,WAAlB,E,CAGA;;AACAC,GAAG,CAACI,GAAJ,CAAQ,UAASK,GAAT,EAAcC,GAAd,EAAmBC,IAAnB,EAAyB;AAC/BA,EAAAA,IAAI,CAACnB,WAAW,CAAC,GAAD,CAAZ,CAAJ;AACD,CAFD,E,CAIA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;AAGA,MAAM;AAACoB,EAAAA;AAAD,IAAgBnB,OAAO,CAAC,SAAD,CAA7B;;AACA,IAAIoB,GAAG,GAAG,4BAAV;;AAGA,SAASC,WAAT,CAAqBC,IAArB,EAA2B;AACzB,MAAIC,MAAM,GAAGhB,GAAG,CAACiB,MAAJ,CAAW,IAAX,EAAiB,MAAM;AAClC,QAAIC,IAAI,GAAGF,MAAM,CAACG,OAAP,GAAiBA,OAA5B;AACA,QAAIJ,IAAI,GAAGC,MAAM,CAACG,OAAP,GAAiBJ,IAA5B;AACAK,IAAAA,OAAO,CAACC,GAAR,CAAa,qBAAoBH,IAAK,IAAGH,IAAK,EAA9C;AACA,GAJW,CAAb;AAKA,SAAOC,MAAP;AACD;AAAA;AACD;AACA;AACA;AACA;AACA;;;AAECF,WAAW;AAEXQ,MAAM,CAACC,OAAP,GAAiBT,WAAjB",
      "sourceRoot": "/home/vinah331/Desktop/tdp013/lab2/",
      "sourcesContent": [
        "var createError = require('http-errors');\nvar express = require('express');\nvar path = require('path');\nvar cookieParser = require('cookie-parser');\nvar logger = require('morgan');\n\nvar indexRouter = require('./routes/index');\nvar usersRouter = require('./routes/users');\n\nvar app = express();\n\n// view engine setup\napp.set('views', path.join(__dirname, 'views'));\napp.set('view engine', 'jade');\n\napp.use(logger('dev'));\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\napp.use(cookieParser());\napp.use(express.static(path.join(__dirname, 'public')));\n\napp.use('/', indexRouter);\napp.use('/users', usersRouter);\n\n\n// catch 404 and forward to error handler\napp.use(function(req, res, next) {\n  next(createError(404));\n});\n\n// error handler\n// app.use(function(err, req, res, next) {\n//   // set locals, only providing error in development\n//   res.locals.message = err.message;\n//   res.locals.error = req.app.get('env') === 'development' ? err : {};\n\n//   // render the error page\n//   res.status(err.status || 500);\n//   res.render('error');\n// });\n\n\nconst {MongoClient} = require('mongodb');\nlet url = \"mongodb://localhost:27017/\";\n\n\nfunction startServer(port) {\n  let server = app.listen(8888, () => {\n    let host = server.address().address\n    let port = server.address().port\n    console.log(`Lyssnar på http://${host}:${port}`)\n   })\n  return(server)\n}/*\nlet server = app.listen(8888, () => {\n  let host = server.address().address\n  let port = server.address().port\n  console.log(`Lyssnar på http://${host}:${port}`)\n })*/\n\n startServer()\n\n module.exports = startServer;"
      ]
    },
    "sourceType": "module",
    "mtime": 1632320817236
  },
  "{\"assumptions\":{},\"sourceRoot\":\"/home/vinah331/Desktop/tdp013/lab2/routes/\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"/home/vinah331/Desktop/tdp013/lab2\",\"filename\":\"/home/vinah331/Desktop/tdp013/lab2/routes/index.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/home/vinah331/Desktop/tdp013/lab2\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.15.5": {
    "metadata": {},
    "options": {
      "assumptions": {},
      "sourceRoot": "/home/vinah331/Desktop/tdp013/lab2/routes/",
      "caller": {
        "name": "@babel/node"
      },
      "cwd": "/home/vinah331/Desktop/tdp013/lab2",
      "filename": "/home/vinah331/Desktop/tdp013/lab2/routes/index.js",
      "targets": {},
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "browserslistConfigFile": false,
      "envName": "development",
      "root": "/home/vinah331/Desktop/tdp013/lab2",
      "rootMode": "root",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/home/vinah331/Desktop/tdp013/lab2/routes/index.js",
        "plugins": []
      },
      "generatorOpts": {
        "filename": "/home/vinah331/Desktop/tdp013/lab2/routes/index.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/home/vinah331/Desktop/tdp013/lab2/routes/",
        "sourceFileName": "index.js"
      }
    },
    "ast": null,
    "code": "var express = require('express');\n\nconst app = express();\nvar router = express.Router();\n\nconst {\n  MongoClient\n} = require('mongodb');\n\nlet sanitize = require('mongo-sanitize');\n\nlet url = \"mongodb://localhost:27017/\";\napp.use(express.json());\napp.use(express.urlencoded({\n  extended: false\n}));\nrouter.all('/messages', function (req, res, next) {\n  console.log(\"1\");\n\n  if (req.method == \"POST\" || req.method == \"GET\") {\n    //Kolla om get har en body?\n    if (req.method == \"GET\" && req.body) {\n      res.sendStatus(405);\n    }\n\n    next();\n  } else {\n    console.log(req.method);\n    res.sendStatus(405);\n  }\n});\nrouter.all('/messages/:id', function (req, res, next) {\n  console.log(\"2\");\n\n  if (req.method == \"PATCH\" || req.method == \"GET\") {\n    next();\n  } else {\n    res.sendStatus(405);\n  }\n}); //------------------------------------------------------------------\n//Save one\n\nrouter.post('/messages', (req, res) => {\n  console.log(\"3\");\n\n  if (validateMsg(req.body)) {\n    msg = sanitize(req.body);\n    const regex = new RegExp(/<script>/); //injection?\n\n    if (!regex.test(msg)) {\n      console.log(req.body);\n      MongoClient.connect(url, (err, db) => {\n        let dbo = db.db(\"tdp013\");\n        dbo.collection('messages').insertOne(msg, function (err, result) {\n          if (err) {\n            console.log(err);\n          } else {\n            console.log('item inserted');\n          }\n\n          db.close();\n          res.sendStatus(200);\n        });\n      });\n    } else {\n      res.sendStatus(500);\n    }\n  } else {\n    res.sendStatus(500);\n  }\n});\n\nfunction validateMsg(body) {\n  if (body.msg.length === 0 || body.msg.length > 140) {\n    return false;\n  }\n\n  if (!(typeof body.id == \"number\")) {\n    return false;\n  }\n\n  if (typeof body.state !== \"boolean\") {\n    return false;\n  }\n\n  return true;\n} //------------------------------------------------------------------\n//Mark read\n\n\nrouter.patch('/messages/:id', (req, res) => {\n  console.log(\"4\"); //if (req.params.id == null) {res.sendStatus(500)}\n\n  let msgId = sanitize(req.params.id);\n  console.log(\"in patch function with value \" + msgId);\n  const regex = new RegExp(/\\D+/);\n\n  if (regex.test(msgId)) {\n    res.sendStatus(400);\n  } else {\n    MongoClient.connect(url, (err, db) => {\n      let dbo = db.db(\"tdp013\");\n      let myquery = {\n        id: msgId\n      };\n      dbo.collection(\"messages\").findOne(myquery, function (err, result) {\n        if (err) {\n          res.sendStatus(500);\n        } else if (result != null) {\n          //If we find a result\n          let newvalues = {\n            $set: {\n              state: !result.state\n            }\n          };\n          dbo.collection(\"messages\").updateOne(myquery, newvalues, function (err, result2) {\n            if (err) {\n              res.sendStatus(500);\n            } else {\n              console.log(\"1 document updated\");\n            }\n\n            db.close();\n            res.sendStatus(200);\n          });\n        } else {\n          //If we dont find a result\n          res.sendStatus(500);\n        }\n      });\n    });\n  }\n}); //------------------------------------------------------------------\n//Get all\n\nrouter.get('/messages', (req, res) => {\n  console.log(\"5\");\n  MongoClient.connect(url, (err, db) => {\n    let dbo = db.db(\"tdp013\");\n    dbo.collection('messages').find({}).toArray(function (err, result) {\n      db.close();\n\n      if (err) {\n        console.log(err);\n      } else if (result != null) {\n        //console.log(result)\n        res.send(result);\n      } else {\n        res.sendStatus(500);\n      }\n    });\n  }); //res.send()\n}); //------------------------------------------------------------------\n// Get one\n\nrouter.get('/messages/:id', (req, res) => {\n  console.log(\"6\");\n  let msgId = sanitize(req.params.id);\n  const regex = new RegExp(/\\D+/);\n\n  if (regex.test(msgId)) {\n    res.sendStatus(400);\n  } else {\n    MongoClient.connect(url, (err, db) => {\n      let dbo = db.db(\"tdp013\");\n      let myquery = {\n        id: msgId\n      };\n      dbo.collection(\"messages\").findOne(myquery, function (err, result) {\n        db.close();\n\n        if (err) {\n          console.log(err);\n        } else if (result != null) {\n          res.send(result); //.json(result)\n        } else {\n          res.sendStatus(500);\n        }\n      });\n    });\n  }\n}); //new RegExp(/\\D+/)\n\n/*\nrouter.all('*', (req, res) => {\n  //If no function exists\n  console.log(\"HERE\")\n  res.sendStatus(404)\n})*/\n\napp.use(function (req, res) {\n  console.log(\"found it\");\n  res.send(\"Sorry can't find that!\", 404);\n});\nmodule.exports = router;\n/*använd asynkrona anrop för att hämta och lagra data. \nKan ta in en resolve och reject funktion. \nMed detta kan vi skicka rätt felmeddelanden.\nen backend fil som hanterar logik\nen testfil som representerar klient-logiken \n(alltså om vi klickar på en knapp kommer meddelande x\nskickas t.ex)*/\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImV4cHJlc3MiLCJyZXF1aXJlIiwiYXBwIiwicm91dGVyIiwiUm91dGVyIiwiTW9uZ29DbGllbnQiLCJzYW5pdGl6ZSIsInVybCIsInVzZSIsImpzb24iLCJ1cmxlbmNvZGVkIiwiZXh0ZW5kZWQiLCJhbGwiLCJyZXEiLCJyZXMiLCJuZXh0IiwiY29uc29sZSIsImxvZyIsIm1ldGhvZCIsImJvZHkiLCJzZW5kU3RhdHVzIiwicG9zdCIsInZhbGlkYXRlTXNnIiwibXNnIiwicmVnZXgiLCJSZWdFeHAiLCJ0ZXN0IiwiY29ubmVjdCIsImVyciIsImRiIiwiZGJvIiwiY29sbGVjdGlvbiIsImluc2VydE9uZSIsInJlc3VsdCIsImNsb3NlIiwibGVuZ3RoIiwiaWQiLCJzdGF0ZSIsInBhdGNoIiwibXNnSWQiLCJwYXJhbXMiLCJteXF1ZXJ5IiwiZmluZE9uZSIsIm5ld3ZhbHVlcyIsIiRzZXQiLCJ1cGRhdGVPbmUiLCJyZXN1bHQyIiwiZ2V0IiwiZmluZCIsInRvQXJyYXkiLCJzZW5kIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSUEsT0FBTyxHQUFHQyxPQUFPLENBQUMsU0FBRCxDQUFyQjs7QUFDQSxNQUFNQyxHQUFHLEdBQUdGLE9BQU8sRUFBbkI7QUFDQSxJQUFJRyxNQUFNLEdBQUdILE9BQU8sQ0FBQ0ksTUFBUixFQUFiOztBQUNBLE1BQU07QUFBQ0MsRUFBQUE7QUFBRCxJQUFnQkosT0FBTyxDQUFDLFNBQUQsQ0FBN0I7O0FBQ0EsSUFBSUssUUFBUSxHQUFHTCxPQUFPLENBQUMsZ0JBQUQsQ0FBdEI7O0FBQ0EsSUFBSU0sR0FBRyxHQUFHLDRCQUFWO0FBRUFMLEdBQUcsQ0FBQ00sR0FBSixDQUFRUixPQUFPLENBQUNTLElBQVIsRUFBUjtBQUNBUCxHQUFHLENBQUNNLEdBQUosQ0FBUVIsT0FBTyxDQUFDVSxVQUFSLENBQW1CO0FBQUVDLEVBQUFBLFFBQVEsRUFBRTtBQUFaLENBQW5CLENB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QSxFQUFFLEVBQUVHO0FBQU4sT0FBZDtBQUVBVCxNQUFBQSxHQUFHLENBQUNDLFVBQUosQ0FBZSxVQUFmLEVBQTJCVyxPQUEzQixDQUFtQ0QsT0FBbkMsRUFBNEMsVUFBU2IsR0FBVCxFQUFjSyxNQUFkLEVBQXNCO0FBQ2hFSixRQUFBQSxFQUFFLENBQUNLLEtBQUg7O0FBQ0EsWUFBSU4sR0FBSixFQUFTO0FBQ1BaLFVBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZVyxHQUFaO0FBQ0QsU0FGRCxNQUdLLElBQUlLLE1BQU0sSUFBSSxJQUFkLEVBQW9CO0FBQ3ZCbkIsVUFBQUEsR0FBRyxDQUFDb0MsSUFBSixDQUFTakIsTUFBVCxFQUR1QixDQUNQO0FBQ2pCLFNBRkksTUFHQTtBQUNIbkIsVUFBQUEsR0FBRyxDQUFDTSxVQUFKLENBQWUsR0FBZjtBQUNEO0FBQ0YsT0FYRDtBQVlELEtBaEJEO0FBaUJEO0FBQ0YsQ0ExQkQsRSxDQTJCQTs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUFsQixHQUFHLENBQUNNLEdBQUosQ0FBUSxVQUFVSyxHQUFWLEVBQWVDLEdBQWYsRUFBb0I7QUFDMUJFLEVBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLFVBQVo7QUFDQUgsRUFBQUEsR0FBRyxDQUFDb0MsSUFBSixDQUFTLHdCQUFULEVBQW1DLEdBQW5DO0FBQ0QsQ0FIRDtBQU1BQyxNQUFNLENBQUNDLE9BQVAsR0FBaUJqRCxNQUFqQjtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6Ii9ob21lL3ZpbmFoMzMxL0Rlc2t0b3AvdGRwMDEzL2xhYjIvcm91dGVzLyIsInNvdXJjZXNDb250ZW50IjpbInZhciBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xuY29uc3QgYXBwID0gZXhwcmVzcygpO1xudmFyIHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG5jb25zdCB7TW9uZ29DbGllbnR9ID0gcmVxdWlyZSgnbW9uZ29kYicpO1xubGV0IHNhbml0aXplID0gcmVxdWlyZSgnbW9uZ28tc2FuaXRpemUnKTtcbmxldCB1cmwgPSBcIm1vbmdvZGI6Ly9sb2NhbGhvc3Q6MjcwMTcvXCI7XG5cbmFwcC51c2UoZXhwcmVzcy5qc29uKCkpO1xuYXBwLnVzZShleHByZXNzLnVybGVuY29kZWQoeyBleHRlbmRlZDogZmFsc2UgfSkpO1xuXG5cbnJvdXRlci5hbGwoJy9tZXNzYWdlcycsIGZ1bmN0aW9uKHJlcSwgcmVzLCBuZXh0KSB7XG4gIGNvbnNvbGUubG9nKFwiMVwiKVxuICBpZihyZXEubWV0aG9kID09IFwiUE9TVFwiIHx8IHJlcS5tZXRob2QgPT0gXCJHRVRcIikge1xuICAgIC8vS29sbGEgb20gZ2V0IGhhciBlbiBib2R5P1xuICAgIGlmIChyZXEubWV0aG9kID09IFwiR0VUXCIgJiYgcmVxLmJvZHkpIHtcbiAgICAgICAgcmVzLnNlbmRTdGF0dXMoNDA1KVxuICAgIH1cbiAgICBuZXh0KCk7XG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS5sb2cocmVxLm1ldGhvZClcbiAgICByZXMuc2VuZFN0YXR1cyg0MDUpXG4gIH1cbn0pXG5cbnJvdXRlci5hbGwoJy9tZXNzYWdlcy86aWQnLCBmdW5jdGlvbihyZXEsIHJlcywgbmV4dCkge1xuICBjb25zb2xlLmxvZyhcIjJcIilcbiAgaWYocmVxLm1ldGhvZCA9PSBcIlBBVENIXCIgfHwgcmVxLm1ldGhvZCA9PSBcIkdFVFwiKSB7XG4gICAgbmV4dCgpO1xuICB9IGVsc2Uge1xuICAgIHJlcy5zZW5kU3RhdHVzKDQwNSlcbiAgfVxufSlcblxuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy9TYXZlIG9uZVxuXG5yb3V0ZXIucG9zdCgnL21lc3NhZ2VzJywgKHJlcSwgcmVzKSA9PiB7XG4gIGNvbnNvbGUubG9nKFwiM1wiKVxuICBpZiAodmFsaWRhdGVNc2cocmVxLmJvZHkpKSB7XG4gICAgbXNnID0gc2FuaXRpemUocmVxLmJvZHkpXG4gICAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKC88c2NyaXB0Pi8pICAvL2luamVjdGlvbj9cbiAgICBpZiAoIXJlZ2V4LnRlc3QobXNnKSkge1xuICAgICAgY29uc29sZS5sb2cocmVxLmJvZHkpXG4gICAgICBNb25nb0NsaWVudC5jb25uZWN0KHVybCwgKGVyciwgZGIpID0+IHtcbiAgICAgICAgbGV0IGRibyA9IGRiLmRiKFwidGRwMDEzXCIpO1xuICAgICAgICBkYm8uY29sbGVjdGlvbignbWVzc2FnZXMnKS5pbnNlcnRPbmUobXNnLCBmdW5jdGlvbihlcnIsIHJlc3VsdCkge1xuICAgICAgICAgIGlmIChlcnIpIHtjb25zb2xlLmxvZyhlcnIpfVxuICAgICAgICAgIGVsc2Uge2NvbnNvbGUubG9nKCdpdGVtIGluc2VydGVkJyl9XG4gICAgICAgICAgZGIuY2xvc2UoKTtcbiAgICAgICAgICByZXMuc2VuZFN0YXR1cygyMDApXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgcmVzLnNlbmRTdGF0dXMoNTAwKVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICByZXMuc2VuZFN0YXR1cyg1MDApXG4gIH1cbiAgXG59KVxuXG5mdW5jdGlvbiB2YWxpZGF0ZU1zZyhib2R5KSB7XG5cbiAgaWYgKGJvZHkubXNnLmxlbmd0aCA9PT0gMCB8fCBib2R5Lm1zZy5sZW5ndGggPiAxNDApIHsgcmV0dXJuIGZhbHNlIH1cbiAgaWYgKCEodHlwZW9mKGJvZHkuaWQpID09IFwibnVtYmVyXCIpKSAgICAgICAgICAgICAgICAgICAgICAgIHsgcmV0dXJuIGZhbHNlIH1cbiAgaWYgKHR5cGVvZihib2R5LnN0YXRlKSAhPT0gXCJib29sZWFuXCIpICAgICAgICAgICAgICAgICB7IHJldHVybiBmYWxzZSB9XG4gIHJldHVybiB0cnVlXG59XG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vL01hcmsgcmVhZFxucm91dGVyLnBhdGNoKCgnL21lc3NhZ2VzLzppZCcpLCAocmVxLCByZXMpID0+IHtcbiAgY29uc29sZS5sb2coXCI0XCIpXG4gIC8vaWYgKHJlcS5wYXJhbXMuaWQgPT0gbnVsbCkge3Jlcy5zZW5kU3RhdHVzKDUwMCl9XG5cbiAgbGV0IG1zZ0lkID0gc2FuaXRpemUocmVxLnBhcmFtcy5pZClcbiAgY29uc29sZS5sb2coXCJpbiBwYXRjaCBmdW5jdGlvbiB3aXRoIHZhbHVlIFwiICsgbXNnSWQpXG4gIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cCgvXFxEKy8pXG5cbiAgaWYgKHJlZ2V4LnRlc3QobXNnSWQpKSB7XG4gICAgcmVzLnNlbmRTdGF0dXMoNDAwKVxuXG4gIH0gZWxzZSB7XG4gICAgTW9uZ29DbGllbnQuY29ubmVjdCh1cmwsIChlcnIsIGRiKSA9PiB7XG4gICAgICBsZXQgZGJvID0gZGIuZGIoXCJ0ZHAwMTNcIik7XG4gICAgICBsZXQgbXlxdWVyeSA9IHsgaWQ6IG1zZ0lkIH07XG4gICAgICBcbiAgICAgIGRiby5jb2xsZWN0aW9uKFwibWVzc2FnZXNcIikuZmluZE9uZShteXF1ZXJ5LCBmdW5jdGlvbihlcnIsIHJlc3VsdCkge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgcmVzLnNlbmRTdGF0dXMoNTAwKVxuICAgICAgICB9IFxuICAgICAgICBlbHNlIGlmIChyZXN1bHQgIT0gbnVsbCkge1xuICAgICAgICAgIC8vSWYgd2UgZmluZCBhIHJlc3VsdFxuICAgICAgICAgIGxldCBuZXd2YWx1ZXMgPSB7ICRzZXQ6IHtzdGF0ZTogIShyZXN1bHQuc3RhdGUpfSB9O1xuICAgICAgICAgIFxuICAgICAgICAgIGRiby5jb2xsZWN0aW9uKFwibWVzc2FnZXNcIikudXBkYXRlT25lKG15cXVlcnksIG5ld3ZhbHVlcywgZnVuY3Rpb24oZXJyLCByZXN1bHQyKSB7XG4gICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgIHJlcy5zZW5kU3RhdHVzKDUwMClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge2NvbnNvbGUubG9nKFwiMSBkb2N1bWVudCB1cGRhdGVkXCIpO31cbiAgICAgICAgICAgIGRiLmNsb3NlKCk7XG4gICAgICAgICAgICByZXMuc2VuZFN0YXR1cygyMDApXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gXG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIC8vSWYgd2UgZG9udCBmaW5kIGEgcmVzdWx0XG4gICAgICAgICAgcmVzLnNlbmRTdGF0dXMoNTAwKVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIFxuICAgIH0pO1xuICB9XG59KVxuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy9HZXQgYWxsXG5yb3V0ZXIuZ2V0KCgnL21lc3NhZ2VzJyksIChyZXEsIHJlcykgPT4ge1xuICBjb25zb2xlLmxvZyhcIjVcIilcblxuICBNb25nb0NsaWVudC5jb25uZWN0KHVybCwgKGVyciwgZGIpID0+IHtcbiAgICBsZXQgZGJvID0gZGIuZGIoXCJ0ZHAwMTNcIik7XG5cbiAgICBkYm8uY29sbGVjdGlvbignbWVzc2FnZXMnKS5maW5kKHt9KS50b0FycmF5KGZ1bmN0aW9uKGVyciwgcmVzdWx0KSB7XG4gICAgICBkYi5jbG9zZSgpO1xuICAgICAgaWYgKGVycikge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnIpXG4gICAgICB9XG4gICAgICBlbHNlIGlmIChyZXN1bHQgIT0gbnVsbCkge1xuICAgICAgICAvL2NvbnNvbGUubG9nKHJlc3VsdClcbiAgICAgICAgcmVzLnNlbmQocmVzdWx0KVxuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHJlcy5zZW5kU3RhdHVzKDUwMClcbiAgICAgIH1cbiAgICB9KVxuICAgIFxuICB9KVxuICAvL3Jlcy5zZW5kKClcbn0pXG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBHZXQgb25lXG5yb3V0ZXIuZ2V0KCgnL21lc3NhZ2VzLzppZCcpLCAocmVxLCByZXMpID0+IHtcbiAgY29uc29sZS5sb2coXCI2XCIpXG4gIGxldCBtc2dJZCA9IHNhbml0aXplKHJlcS5wYXJhbXMuaWQpXG4gIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cCgvXFxEKy8pXG4gIGlmIChyZWdleC50ZXN0KG1zZ0lkKSkge1xuICAgIHJlcy5zZW5kU3RhdHVzKDQwMClcbiAgfSBlbHNlIHtcblxuICAgIE1vbmdvQ2xpZW50LmNvbm5lY3QodXJsLCAoZXJyLCBkYikgPT4ge1xuICAgICAgbGV0IGRibyA9IGRiLmRiKFwidGRwMDEzXCIpO1xuICAgICAgbGV0IG15cXVlcnkgPSB7IGlkOiBtc2dJZCB9O1xuXG4gICAgICBkYm8uY29sbGVjdGlvbihcIm1lc3NhZ2VzXCIpLmZpbmRPbmUobXlxdWVyeSwgZnVuY3Rpb24oZXJyLCByZXN1bHQpIHtcbiAgICAgICAgZGIuY2xvc2UoKTtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGVycilcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChyZXN1bHQgIT0gbnVsbCkge1xuICAgICAgICAgIHJlcy5zZW5kKHJlc3VsdCkvLy5qc29uKHJlc3VsdClcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICByZXMuc2VuZFN0YXR1cyg1MDApXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG59KVxuLy9uZXcgUmVnRXhwKC9cXEQrLylcbi8qXG5yb3V0ZXIuYWxsKCcqJywgKHJlcSwgcmVzKSA9PiB7XG4gIC8vSWYgbm8gZnVuY3Rpb24gZXhpc3RzXG4gIGNvbnNvbGUubG9nKFwiSEVSRVwiKVxuICByZXMuc2VuZFN0YXR1cyg0MDQpXG59KSovXG5cbmFwcC51c2UoZnVuY3Rpb24gKHJlcSwgcmVzKSB7XG4gIGNvbnNvbGUubG9nKFwiZm91bmQgaXRcIilcbiAgcmVzLnNlbmQoXCJTb3JyeSBjYW4ndCBmaW5kIHRoYXQhXCIsIDQwNClcbn0pXG5cblxubW9kdWxlLmV4cG9ydHMgPSByb3V0ZXI7XG5cblxuLyphbnbDpG5kIGFzeW5rcm9uYSBhbnJvcCBmw7ZyIGF0dCBow6RtdGEgb2NoIGxhZ3JhIGRhdGEuIFxuS2FuIHRhIGluIGVuIHJlc29sdmUgb2NoIHJlamVjdCBmdW5rdGlvbi4gXG5NZWQgZGV0dGEga2FuIHZpIHNraWNrYSByw6R0dCBmZWxtZWRkZWxhbmRlbi5cbmVuIGJhY2tlbmQgZmlsIHNvbSBoYW50ZXJhciBsb2dpa1xuZW4gdGVzdGZpbCBzb20gcmVwcmVzZW50ZXJhciBrbGllbnQtbG9naWtlbiBcbihhbGx0c8OlIG9tIHZpIGtsaWNrYXIgcMOlIGVuIGtuYXBwIGtvbW1lciBtZWRkZWxhbmRlIHhcbnNraWNrYXMgdC5leCkqL1xuIl19",
    "map": {
      "version": 3,
      "sources": [
        "index.js"
      ],
      "names": [
        "express",
        "require",
        "app",
        "router",
        "Router",
        "MongoClient",
        "sanitize",
        "url",
        "use",
        "json",
        "urlencoded",
        "extended",
        "all",
        "req",
        "res",
        "next",
        "console",
        "log",
        "method",
        "body",
        "sendStatus",
        "post",
        "validateMsg",
        "msg",
        "regex",
        "RegExp",
        "test",
        "connect",
        "err",
        "db",
        "dbo",
        "collection",
        "insertOne",
        "result",
        "close",
        "length",
        "id",
        "state",
        "patch",
        "msgId",
        "params",
        "myquery",
        "findOne",
        "newvalues",
        "$set",
        "updateOne",
        "result2",
        "get",
        "find",
        "toArray",
        "send",
        "module",
        "exports"
      ],
      "mappings": "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",
      "sourceRoot": "/home/vinah331/Desktop/tdp013/lab2/routes/",
      "sourcesContent": [
        "var express = require('express');\nconst app = express();\nvar router = express.Router();\nconst {MongoClient} = require('mongodb');\nlet sanitize = require('mongo-sanitize');\nlet url = \"mongodb://localhost:27017/\";\n\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\n\nrouter.all('/messages', function(req, res, next) {\n  console.log(\"1\")\n  if(req.method == \"POST\" || req.method == \"GET\") {\n    //Kolla om get har en body?\n    if (req.method == \"GET\" && req.body) {\n        res.sendStatus(405)\n    }\n    next();\n  } else {\n    console.log(req.method)\n    res.sendStatus(405)\n  }\n})\n\nrouter.all('/messages/:id', function(req, res, next) {\n  console.log(\"2\")\n  if(req.method == \"PATCH\" || req.method == \"GET\") {\n    next();\n  } else {\n    res.sendStatus(405)\n  }\n})\n\n\n//------------------------------------------------------------------\n//Save one\n\nrouter.post('/messages', (req, res) => {\n  console.log(\"3\")\n  if (validateMsg(req.body)) {\n    msg = sanitize(req.body)\n    const regex = new RegExp(/<script>/)  //injection?\n    if (!regex.test(msg)) {\n      console.log(req.body)\n      MongoClient.connect(url, (err, db) => {\n        let dbo = db.db(\"tdp013\");\n        dbo.collection('messages').insertOne(msg, function(err, result) {\n          if (err) {console.log(err)}\n          else {console.log('item inserted')}\n          db.close();\n          res.sendStatus(200)\n        });\n      });\n    }\n    else {\n      res.sendStatus(500)\n    }\n  } else {\n    res.sendStatus(500)\n  }\n  \n})\n\nfunction validateMsg(body) {\n\n  if (body.msg.length === 0 || body.msg.length > 140) { return false }\n  if (!(typeof(body.id) == \"number\"))                        { return false }\n  if (typeof(body.state) !== \"boolean\")                 { return false }\n  return true\n}\n\n//------------------------------------------------------------------\n//Mark read\nrouter.patch(('/messages/:id'), (req, res) => {\n  console.log(\"4\")\n  //if (req.params.id == null) {res.sendStatus(500)}\n\n  let msgId = sanitize(req.params.id)\n  console.log(\"in patch function with value \" + msgId)\n  const regex = new RegExp(/\\D+/)\n\n  if (regex.test(msgId)) {\n    res.sendStatus(400)\n\n  } else {\n    MongoClient.connect(url, (err, db) => {\n      let dbo = db.db(\"tdp013\");\n      let myquery = { id: msgId };\n      \n      dbo.collection(\"messages\").findOne(myquery, function(err, result) {\n        if (err) {\n          res.sendStatus(500)\n        } \n        else if (result != null) {\n          //If we find a result\n          let newvalues = { $set: {state: !(result.state)} };\n          \n          dbo.collection(\"messages\").updateOne(myquery, newvalues, function(err, result2) {\n            if (err) {\n              res.sendStatus(500)\n            }\n            else {console.log(\"1 document updated\");}\n            db.close();\n            res.sendStatus(200)\n          });\n        } \n        else {\n          //If we dont find a result\n          res.sendStatus(500)\n        }\n      });\n      \n    });\n  }\n})\n\n//------------------------------------------------------------------\n//Get all\nrouter.get(('/messages'), (req, res) => {\n  console.log(\"5\")\n\n  MongoClient.connect(url, (err, db) => {\n    let dbo = db.db(\"tdp013\");\n\n    dbo.collection('messages').find({}).toArray(function(err, result) {\n      db.close();\n      if (err) {\n        console.log(err)\n      }\n      else if (result != null) {\n        //console.log(result)\n        res.send(result)\n      }\n      else {\n        res.sendStatus(500)\n      }\n    })\n    \n  })\n  //res.send()\n})\n\n//------------------------------------------------------------------\n// Get one\nrouter.get(('/messages/:id'), (req, res) => {\n  console.log(\"6\")\n  let msgId = sanitize(req.params.id)\n  const regex = new RegExp(/\\D+/)\n  if (regex.test(msgId)) {\n    res.sendStatus(400)\n  } else {\n\n    MongoClient.connect(url, (err, db) => {\n      let dbo = db.db(\"tdp013\");\n      let myquery = { id: msgId };\n\n      dbo.collection(\"messages\").findOne(myquery, function(err, result) {\n        db.close();\n        if (err) {\n          console.log(err)\n        }\n        else if (result != null) {\n          res.send(result)//.json(result)\n        }\n        else {\n          res.sendStatus(500)\n        }\n      });\n    });\n  }\n})\n//new RegExp(/\\D+/)\n/*\nrouter.all('*', (req, res) => {\n  //If no function exists\n  console.log(\"HERE\")\n  res.sendStatus(404)\n})*/\n\napp.use(function (req, res) {\n  console.log(\"found it\")\n  res.send(\"Sorry can't find that!\", 404)\n})\n\n\nmodule.exports = router;\n\n\n/*använd asynkrona anrop för att hämta och lagra data. \nKan ta in en resolve och reject funktion. \nMed detta kan vi skicka rätt felmeddelanden.\nen backend fil som hanterar logik\nen testfil som representerar klient-logiken \n(alltså om vi klickar på en knapp kommer meddelande x\nskickas t.ex)*/\n"
      ]
    },
    "sourceType": "module",
    "mtime": 1632320765296
  },
  "{\"assumptions\":{},\"sourceRoot\":\"/home/vinah331/Desktop/tdp013/lab2/routes/\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"/home/vinah331/Desktop/tdp013/lab2\",\"filename\":\"/home/vinah331/Desktop/tdp013/lab2/routes/users.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/home/vinah331/Desktop/tdp013/lab2\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.15.5": {
    "metadata": {},
    "options": {
      "assumptions": {},
      "sourceRoot": "/home/vinah331/Desktop/tdp013/lab2/routes/",
      "caller": {
        "name": "@babel/node"
      },
      "cwd": "/home/vinah331/Desktop/tdp013/lab2",
      "filename": "/home/vinah331/Desktop/tdp013/lab2/routes/users.js",
      "targets": {},
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "browserslistConfigFile": false,
      "envName": "development",
      "root": "/home/vinah331/Desktop/tdp013/lab2",
      "rootMode": "root",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/home/vinah331/Desktop/tdp013/lab2/routes/users.js",
        "plugins": []
      },
      "generatorOpts": {
        "filename": "/home/vinah331/Desktop/tdp013/lab2/routes/users.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/home/vinah331/Desktop/tdp013/lab2/routes/",
        "sourceFileName": "users.js"
      }
    },
    "ast": null,
    "code": "var express = require('express');\n\nvar router = express.Router();\n/* GET users listing. */\n\nrouter.get('/', function (req, res, next) {\n  res.send('respond with a resource');\n});\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZXJzLmpzIl0sIm5hbWVzIjpbImV4cHJlc3MiLCJyZXF1aXJlIiwicm91dGVyIiwiUm91dGVyIiwiZ2V0IiwicmVxIiwicmVzIiwibmV4dCIsInNlbmQiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQSxJQUFJQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxTQUFELENBQXJCOztBQUNBLElBQUlDLE1BQU0sR0FBR0YsT0FBTyxDQUFDRyxNQUFSLEVBQWI7QUFFQTs7QUFDQUQsTUFBTSxDQUFDRSxHQUFQLENBQVcsR0FBWCxFQUFnQixVQUFTQyxHQUFULEVBQWNDLEdBQWQsRUFBbUJDLElBQW5CLEVBQXlCO0FBQ3ZDRCxFQUFBQSxHQUFHLENBQUNFLElBQUosQ0FBUyx5QkFBVDtBQUNELENBRkQ7QUFJQUMsTUFBTSxDQUFDQyxPQUFQLEdBQWlCUixNQUFqQiIsInNvdXJjZVJvb3QiOiIvaG9tZS92aW5haDMzMS9EZXNrdG9wL3RkcDAxMy9sYWIyL3JvdXRlcy8iLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbnZhciByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xuXG4vKiBHRVQgdXNlcnMgbGlzdGluZy4gKi9cbnJvdXRlci5nZXQoJy8nLCBmdW5jdGlvbihyZXEsIHJlcywgbmV4dCkge1xuICByZXMuc2VuZCgncmVzcG9uZCB3aXRoIGEgcmVzb3VyY2UnKTtcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHJvdXRlcjtcbiJdfQ==",
    "map": {
      "version": 3,
      "sources": [
        "users.js"
      ],
      "names": [
        "express",
        "require",
        "router",
        "Router",
        "get",
        "req",
        "res",
        "next",
        "send",
        "module",
        "exports"
      ],
      "mappings": "AAAA,IAAIA,OAAO,GAAGC,OAAO,CAAC,SAAD,CAArB;;AACA,IAAIC,MAAM,GAAGF,OAAO,CAACG,MAAR,EAAb;AAEA;;AACAD,MAAM,CAACE,GAAP,CAAW,GAAX,EAAgB,UAASC,GAAT,EAAcC,GAAd,EAAmBC,IAAnB,EAAyB;AACvCD,EAAAA,GAAG,CAACE,IAAJ,CAAS,yBAAT;AACD,CAFD;AAIAC,MAAM,CAACC,OAAP,GAAiBR,MAAjB",
      "sourceRoot": "/home/vinah331/Desktop/tdp013/lab2/routes/",
      "sourcesContent": [
        "var express = require('express');\nvar router = express.Router();\n\n/* GET users listing. */\nrouter.get('/', function(req, res, next) {\n  res.send('respond with a resource');\n});\n\nmodule.exports = router;\n"
      ]
    },
    "sourceType": "module",
    "mtime": 1631534435311
  }
}