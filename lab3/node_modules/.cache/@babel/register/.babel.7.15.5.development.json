{
  "{\"assumptions\":{},\"sourceRoot\":\"/home/vinah331/Desktop/tdp013/lab2/\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"/home/vinah331/Desktop/tdp013/lab2\",\"filename\":\"/home/vinah331/Desktop/tdp013/lab2/app.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/home/vinah331/Desktop/tdp013/lab2\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.15.5": {
    "metadata": {},
    "options": {
      "assumptions": {},
      "sourceRoot": "/home/vinah331/Desktop/tdp013/lab2/",
      "caller": {
        "name": "@babel/node"
      },
      "cwd": "/home/vinah331/Desktop/tdp013/lab2",
      "filename": "/home/vinah331/Desktop/tdp013/lab2/app.js",
      "targets": {},
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "browserslistConfigFile": false,
      "envName": "development",
      "root": "/home/vinah331/Desktop/tdp013/lab2",
      "rootMode": "root",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/home/vinah331/Desktop/tdp013/lab2/app.js",
        "plugins": []
      },
      "generatorOpts": {
        "filename": "/home/vinah331/Desktop/tdp013/lab2/app.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/home/vinah331/Desktop/tdp013/lab2/",
        "sourceFileName": "app.js"
      }
    },
    "ast": null,
    "code": "var createError = require('http-errors');\n\nvar express = require('express');\n\nvar path = require('path');\n\nvar cookieParser = require('cookie-parser');\n\nvar logger = require('morgan');\n\nvar indexRouter = require('./routes/index');\n\nvar usersRouter = require('./routes/users');\n\nvar app = express(); // view engine setup\n\napp.set('views', path.join(__dirname, 'views'));\napp.set('view engine', 'jade');\napp.use(logger('dev'));\napp.use(express.json());\napp.use(express.urlencoded({\n  extended: false\n}));\napp.use(cookieParser());\napp.use(express.static(path.join(__dirname, 'public')));\napp.use('/', indexRouter);\napp.use('/users', usersRouter); // catch 404 and forward to error handler //använd inte!\n// app.use(function(req, res, next) {\n//   next(createError(404));\n// });\n// error handler\n// app.use(function(err, req, res, next) {\n//   // set locals, only providing error in development\n//   res.locals.message = err.message;\n//   res.locals.error = req.app.get('env') === 'development' ? err : {};\n//   // render the error page\n//   res.status(err.status || 500);\n//   res.render('error');\n// });\n\nconst {\n  MongoClient\n} = require('mongodb');\n\nlet url = \"mongodb://localhost:27017/\";\n\nfunction startServer(port) {\n  let server = app.listen(8888, () => {\n    let host = server.address().address;\n    let port = server.address().port;\n    console.log(`Lyssnar på http://${host}:${port}`);\n  });\n  return server;\n}\n\nfunction clearDatabase() {\n  MongoClient.dropDatabase();\n}\n/*\nlet server = app.listen(8888, () => {\n  let host = server.address().address\n  let port = server.address().port\n  console.log(`Lyssnar på http://${host}:${port}`)\n })*/\n\n\nstartServer();\nmodule.exports = startServer;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJjcmVhdGVFcnJvciIsInJlcXVpcmUiLCJleHByZXNzIiwicGF0aCIsImNvb2tpZVBhcnNlciIsImxvZ2dlciIsImluZGV4Um91dGVyIiwidXNlcnNSb3V0ZXIiLCJhcHAiLCJzZXQiLCJqb2luIiwiX19kaXJuYW1lIiwidXNlIiwianNvbiIsInVybGVuY29kZWQiLCJleHRlbmRlZCIsInN0YXRpYyIsIk1vbmdvQ2xpZW50IiwidXJsIiwic3RhcnRTZXJ2ZXIiLCJwb3J0Iiwic2VydmVyIiwibGlzdGVuIiwiaG9zdCIsImFkZHJlc3MiLCJjb25zb2xlIiwibG9nIiwiY2xlYXJEYXRhYmFzZSIsImRyb3BEYXRhYmFzZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQUFBLElBQUlBLFdBQVcsR0FBR0MsT0FBTyxDQUFDLGFBQUQsQ0FBekI7O0FBQ0EsSUFBSUMsT0FBTyxHQUFHRCxPQUFPLENBQUMsU0FBRCxDQUFyQjs7QUFDQSxJQUFJRSxJQUFJLEdBQUdGLE9BQU8sQ0FBQyxNQUFELENBQWxCOztBQUNBLElBQUlHLFlBQVksR0FBR0gsT0FBTyxDQUFDLGVBQUQsQ0FBMUI7O0FBQ0EsSUFBSUksTUFBTSxHQUFHSixPQUFPLENBQUMsUUFBRCxDQUFwQjs7QUFFQSxJQUFJSyxXQUFXLEdBQUdMLE9BQU8sQ0FBQyxnQkFBRCxDQUF6Qjs7QUFDQSxJQUFJTSxXQUFXLEdBQUdOLE9BQU8sQ0FBQyxnQkFBRCxDQUF6Qjs7QUFFQSxJQUFJTyxHQUFHLEdBQUdOLE9BQU8sRUFBakIsQyxDQUVBOztBQUNBTSxHQUFHLENBQUNDLEdBQUosQ0FBUSxPQUFSLEVBQWlCTixJQUFJLENBQUNPLElBQUwsQ0FBVUMsU0FBVixFQUFxQixPQUFyQixDQUFqQjtBQUNBSCxHQUFHLENBQUNDLEdBQUosQ0FBUSxhQUFSLEVBQXVCLE1BQXZCO0FBRUFELEdBQUcsQ0FBQ0ksR0FBSixDQUFRUCxNQUFNLENBQUMsS0FBRCxDQUFkO0FBQ0FHLEdBQUcsQ0FBQ0ksR0FBSixDQUFRVixPQUFPLENBQUNXLElBQVIsRUFBUjtBQUNBTCxHQUFHLENBQUNJLEdBQUosQ0FBUVYsT0FBTyxDQUFDWSxVQUFSLENBQW1CO0FBQUVDLEVBQUFBLFFBQVEsRUFBRTtBQUFaLENBQW5CLENBQVI7QUFDQVAsR0FBRyxDQUFDSSxHQUFKLENBQVFSLFlBQVksRUFBcEI7QUFDQUksR0FBRyxDQUFDSSxHQUFKLENBQVFWLE9BQU8sQ0FBQ2MsTUFBUixDQUFlYixJQUFJLENBQUNPLElBQUwsQ0FBVUMsU0FBVixFQUFxQixRQUFyQixDQUFmLENBQVI7QUFFQUgsR0FBRyxDQUFDSSxHQUFKLENBQVEsR0FBUixFQUFhTixXQUFiO0FBQ0FFLEdBQUcsQ0FBQ0ksR0FBSixDQUFRLFFBQVIsRUFBa0JMLFdBQWxCLEUsQ0FHQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFHQSxNQUFNO0FBQUNVLEVBQUFBO0FBQUQsSUFBZ0JoQixPQUFPLENBQUMsU0FBRCxDQUE3Qjs7QUFDQSxJQUFJaUIsR0FBRyxHQUFHLDRCQUFWOztBQUdBLFNBQVNDLFdBQVQsQ0FBcUJDLElBQXJCLEVBQTJCO0FBQ3pCLE1BQUlDLE1BQU0sR0FBR2IsR0FBRyxDQUFDYyxNQUFKLENBQVcsSUFBWCxFQUFpQixNQUFNO0FBQ2xDLFFBQUlDLElBQUksR0FBR0YsTUFBTSxDQUFDRyxPQUFQLEdBQWlCQSxPQUE1QjtBQUNBLFFBQUlKLElBQUksR0FBR0MsTUFBTSxDQUFDRyxPQUFQLEdBQWlCSixJQUE1QjtBQUNBSyxJQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBYSxxQkFBb0JILElBQUssSUFBR0gsSUFBSyxFQUE5QztBQUNBLEdBSlcsQ0FBYjtBQUtBLFNBQU9DLE1BQVA7QUFDRDs7QUFFRCxTQUFTTSxhQUFULEdBQXlCO0FBQ3ZCVixFQUFBQSxXQUFXLENBQUNXLFlBQVo7QUFDRDtBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBRUNULFdBQVc7QUFFWFUsTUFBTSxDQUFDQyxPQUFQLEdBQWlCWCxXQUFqQiIsInNvdXJjZVJvb3QiOiIvaG9tZS92aW5haDMzMS9EZXNrdG9wL3RkcDAxMy9sYWIyLyIsInNvdXJjZXNDb250ZW50IjpbInZhciBjcmVhdGVFcnJvciA9IHJlcXVpcmUoJ2h0dHAtZXJyb3JzJyk7XG52YXIgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbnZhciBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xudmFyIGNvb2tpZVBhcnNlciA9IHJlcXVpcmUoJ2Nvb2tpZS1wYXJzZXInKTtcbnZhciBsb2dnZXIgPSByZXF1aXJlKCdtb3JnYW4nKTtcblxudmFyIGluZGV4Um91dGVyID0gcmVxdWlyZSgnLi9yb3V0ZXMvaW5kZXgnKTtcbnZhciB1c2Vyc1JvdXRlciA9IHJlcXVpcmUoJy4vcm91dGVzL3VzZXJzJyk7XG5cbnZhciBhcHAgPSBleHByZXNzKCk7XG5cbi8vIHZpZXcgZW5naW5lIHNldHVwXG5hcHAuc2V0KCd2aWV3cycsIHBhdGguam9pbihfX2Rpcm5hbWUsICd2aWV3cycpKTtcbmFwcC5zZXQoJ3ZpZXcgZW5naW5lJywgJ2phZGUnKTtcblxuYXBwLnVzZShsb2dnZXIoJ2RldicpKTtcbmFwcC51c2UoZXhwcmVzcy5qc29uKCkpO1xuYXBwLnVzZShleHByZXNzLnVybGVuY29kZWQoeyBleHRlbmRlZDogZmFsc2UgfSkpO1xuYXBwLnVzZShjb29raWVQYXJzZXIoKSk7XG5hcHAudXNlKGV4cHJlc3Muc3RhdGljKHBhdGguam9pbihfX2Rpcm5hbWUsICdwdWJsaWMnKSkpO1xuXG5hcHAudXNlKCcvJywgaW5kZXhSb3V0ZXIpO1xuYXBwLnVzZSgnL3VzZXJzJywgdXNlcnNSb3V0ZXIpO1xuXG5cbi8vIGNhdGNoIDQwNCBhbmQgZm9yd2FyZCB0byBlcnJvciBoYW5kbGVyIC8vYW52w6RuZCBpbnRlIVxuLy8gYXBwLnVzZShmdW5jdGlvbihyZXEsIHJlcywgbmV4dCkge1xuLy8gICBuZXh0KGNyZWF0ZUVycm9yKDQwNCkpO1xuLy8gfSk7XG5cbi8vIGVycm9yIGhhbmRsZXJcbi8vIGFwcC51c2UoZnVuY3Rpb24oZXJyLCByZXEsIHJlcywgbmV4dCkge1xuLy8gICAvLyBzZXQgbG9jYWxzLCBvbmx5IHByb3ZpZGluZyBlcnJvciBpbiBkZXZlbG9wbWVudFxuLy8gICByZXMubG9jYWxzLm1lc3NhZ2UgPSBlcnIubWVzc2FnZTtcbi8vICAgcmVzLmxvY2Fscy5lcnJvciA9IHJlcS5hcHAuZ2V0KCdlbnYnKSA9PT0gJ2RldmVsb3BtZW50JyA/IGVyciA6IHt9O1xuXG4vLyAgIC8vIHJlbmRlciB0aGUgZXJyb3IgcGFnZVxuLy8gICByZXMuc3RhdHVzKGVyci5zdGF0dXMgfHwgNTAwKTtcbi8vICAgcmVzLnJlbmRlcignZXJyb3InKTtcbi8vIH0pO1xuXG5cbmNvbnN0IHtNb25nb0NsaWVudH0gPSByZXF1aXJlKCdtb25nb2RiJyk7XG5sZXQgdXJsID0gXCJtb25nb2RiOi8vbG9jYWxob3N0OjI3MDE3L1wiO1xuXG5cbmZ1bmN0aW9uIHN0YXJ0U2VydmVyKHBvcnQpIHtcbiAgbGV0IHNlcnZlciA9IGFwcC5saXN0ZW4oODg4OCwgKCkgPT4ge1xuICAgIGxldCBob3N0ID0gc2VydmVyLmFkZHJlc3MoKS5hZGRyZXNzXG4gICAgbGV0IHBvcnQgPSBzZXJ2ZXIuYWRkcmVzcygpLnBvcnRcbiAgICBjb25zb2xlLmxvZyhgTHlzc25hciBww6UgaHR0cDovLyR7aG9zdH06JHtwb3J0fWApXG4gICB9KVxuICByZXR1cm4oc2VydmVyKVxufVxuXG5mdW5jdGlvbiBjbGVhckRhdGFiYXNlKCkge1xuICBNb25nb0NsaWVudC5kcm9wRGF0YWJhc2UoKTtcbn1cbi8qXG5sZXQgc2VydmVyID0gYXBwLmxpc3Rlbig4ODg4LCAoKSA9PiB7XG4gIGxldCBob3N0ID0gc2VydmVyLmFkZHJlc3MoKS5hZGRyZXNzXG4gIGxldCBwb3J0ID0gc2VydmVyLmFkZHJlc3MoKS5wb3J0XG4gIGNvbnNvbGUubG9nKGBMeXNzbmFyIHDDpSBodHRwOi8vJHtob3N0fToke3BvcnR9YClcbiB9KSovXG5cbiBzdGFydFNlcnZlcigpXG5cbiBtb2R1bGUuZXhwb3J0cyA9IHN0YXJ0U2VydmVyOyJdfQ==",
    "map": {
      "version": 3,
      "sources": [
        "app.js"
      ],
      "names": [
        "createError",
        "require",
        "express",
        "path",
        "cookieParser",
        "logger",
        "indexRouter",
        "usersRouter",
        "app",
        "set",
        "join",
        "__dirname",
        "use",
        "json",
        "urlencoded",
        "extended",
        "static",
        "MongoClient",
        "url",
        "startServer",
        "port",
        "server",
        "listen",
        "host",
        "address",
        "console",
        "log",
        "clearDatabase",
        "dropDatabase",
        "module",
        "exports"
      ],
      "mappings": "AAAA,IAAIA,WAAW,GAAGC,OAAO,CAAC,aAAD,CAAzB;;AACA,IAAIC,OAAO,GAAGD,OAAO,CAAC,SAAD,CAArB;;AACA,IAAIE,IAAI,GAAGF,OAAO,CAAC,MAAD,CAAlB;;AACA,IAAIG,YAAY,GAAGH,OAAO,CAAC,eAAD,CAA1B;;AACA,IAAII,MAAM,GAAGJ,OAAO,CAAC,QAAD,CAApB;;AAEA,IAAIK,WAAW,GAAGL,OAAO,CAAC,gBAAD,CAAzB;;AACA,IAAIM,WAAW,GAAGN,OAAO,CAAC,gBAAD,CAAzB;;AAEA,IAAIO,GAAG,GAAGN,OAAO,EAAjB,C,CAEA;;AACAM,GAAG,CAACC,GAAJ,CAAQ,OAAR,EAAiBN,IAAI,CAACO,IAAL,CAAUC,SAAV,EAAqB,OAArB,CAAjB;AACAH,GAAG,CAACC,GAAJ,CAAQ,aAAR,EAAuB,MAAvB;AAEAD,GAAG,CAACI,GAAJ,CAAQP,MAAM,CAAC,KAAD,CAAd;AACAG,GAAG,CAACI,GAAJ,CAAQV,OAAO,CAACW,IAAR,EAAR;AACAL,GAAG,CAACI,GAAJ,CAAQV,OAAO,CAACY,UAAR,CAAmB;AAAEC,EAAAA,QAAQ,EAAE;AAAZ,CAAnB,CAAR;AACAP,GAAG,CAACI,GAAJ,CAAQR,YAAY,EAApB;AACAI,GAAG,CAACI,GAAJ,CAAQV,OAAO,CAACc,MAAR,CAAeb,IAAI,CAACO,IAAL,CAAUC,SAAV,EAAqB,QAArB,CAAf,CAAR;AAEAH,GAAG,CAACI,GAAJ,CAAQ,GAAR,EAAaN,WAAb;AACAE,GAAG,CAACI,GAAJ,CAAQ,QAAR,EAAkBL,WAAlB,E,CAGA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;AAGA,MAAM;AAACU,EAAAA;AAAD,IAAgBhB,OAAO,CAAC,SAAD,CAA7B;;AACA,IAAIiB,GAAG,GAAG,4BAAV;;AAGA,SAASC,WAAT,CAAqBC,IAArB,EAA2B;AACzB,MAAIC,MAAM,GAAGb,GAAG,CAACc,MAAJ,CAAW,IAAX,EAAiB,MAAM;AAClC,QAAIC,IAAI,GAAGF,MAAM,CAACG,OAAP,GAAiBA,OAA5B;AACA,QAAIJ,IAAI,GAAGC,MAAM,CAACG,OAAP,GAAiBJ,IAA5B;AACAK,IAAAA,OAAO,CAACC,GAAR,CAAa,qBAAoBH,IAAK,IAAGH,IAAK,EAA9C;AACA,GAJW,CAAb;AAKA,SAAOC,MAAP;AACD;;AAED,SAASM,aAAT,GAAyB;AACvBV,EAAAA,WAAW,CAACW,YAAZ;AACD;AACD;AACA;AACA;AACA;AACA;AACA;;;AAECT,WAAW;AAEXU,MAAM,CAACC,OAAP,GAAiBX,WAAjB",
      "sourceRoot": "/home/vinah331/Desktop/tdp013/lab2/",
      "sourcesContent": [
        "var createError = require('http-errors');\nvar express = require('express');\nvar path = require('path');\nvar cookieParser = require('cookie-parser');\nvar logger = require('morgan');\n\nvar indexRouter = require('./routes/index');\nvar usersRouter = require('./routes/users');\n\nvar app = express();\n\n// view engine setup\napp.set('views', path.join(__dirname, 'views'));\napp.set('view engine', 'jade');\n\napp.use(logger('dev'));\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\napp.use(cookieParser());\napp.use(express.static(path.join(__dirname, 'public')));\n\napp.use('/', indexRouter);\napp.use('/users', usersRouter);\n\n\n// catch 404 and forward to error handler //använd inte!\n// app.use(function(req, res, next) {\n//   next(createError(404));\n// });\n\n// error handler\n// app.use(function(err, req, res, next) {\n//   // set locals, only providing error in development\n//   res.locals.message = err.message;\n//   res.locals.error = req.app.get('env') === 'development' ? err : {};\n\n//   // render the error page\n//   res.status(err.status || 500);\n//   res.render('error');\n// });\n\n\nconst {MongoClient} = require('mongodb');\nlet url = \"mongodb://localhost:27017/\";\n\n\nfunction startServer(port) {\n  let server = app.listen(8888, () => {\n    let host = server.address().address\n    let port = server.address().port\n    console.log(`Lyssnar på http://${host}:${port}`)\n   })\n  return(server)\n}\n\nfunction clearDatabase() {\n  MongoClient.dropDatabase();\n}\n/*\nlet server = app.listen(8888, () => {\n  let host = server.address().address\n  let port = server.address().port\n  console.log(`Lyssnar på http://${host}:${port}`)\n })*/\n\n startServer()\n\n module.exports = startServer;"
      ]
    },
    "sourceType": "module",
    "mtime": 1632555136045
  },
  "{\"assumptions\":{},\"sourceRoot\":\"/home/vinah331/Desktop/tdp013/lab2/routes/\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"/home/vinah331/Desktop/tdp013/lab2\",\"filename\":\"/home/vinah331/Desktop/tdp013/lab2/routes/index.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/home/vinah331/Desktop/tdp013/lab2\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.15.5": {
    "metadata": {},
    "options": {
      "assumptions": {},
      "sourceRoot": "/home/vinah331/Desktop/tdp013/lab2/routes/",
      "caller": {
        "name": "@babel/node"
      },
      "cwd": "/home/vinah331/Desktop/tdp013/lab2",
      "filename": "/home/vinah331/Desktop/tdp013/lab2/routes/index.js",
      "targets": {},
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "browserslistConfigFile": false,
      "envName": "development",
      "root": "/home/vinah331/Desktop/tdp013/lab2",
      "rootMode": "root",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/home/vinah331/Desktop/tdp013/lab2/routes/index.js",
        "plugins": []
      },
      "generatorOpts": {
        "filename": "/home/vinah331/Desktop/tdp013/lab2/routes/index.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/home/vinah331/Desktop/tdp013/lab2/routes/",
        "sourceFileName": "index.js"
      }
    },
    "ast": null,
    "code": "var express = require('express');\n\nconst app = express();\nvar router = express.Router();\n\nconst {\n  MongoClient\n} = require('mongodb');\n\nlet sanitize = require('mongo-sanitize');\n\nlet url = \"mongodb://localhost:27017/\";\napp.use(express.json());\napp.use(express.urlencoded({\n  extended: false\n}));\nrouter.all('/messages', function (req, res, next) {\n  if (req.method == \"POST\" || req.method == \"GET\") {\n    //Kolla om get har en body?\n    if (req.method == \"GET\" && req.body) {\n      res.sendStatus(405);\n    }\n\n    next();\n  } else {\n    //console.log(req.method)\n    res.sendStatus(405);\n  }\n});\nrouter.all('/messages/:id', function (req, res, next) {\n  //console.log(\"1\")\n  if (req.method == \"PATCH\" || req.method == \"GET\") {\n    next();\n  } else {\n    res.sendStatus(405);\n  }\n}); //------------------------------------------------------------------\n//Save one\n\nrouter.post('/messages', (req, res) => {\n  if (validateMsg(req.body)) {\n    msg = sanitize(req.body);\n    const regex = new RegExp(/<script>/); //injection?\n\n    if (!regex.test(msg)) {\n      //console.log(req.body)\n      MongoClient.connect(url, (err, db) => {\n        let dbo = db.db(\"tdp013\");\n        dbo.collection('messages').insertOne(msg, function (err, result) {\n          if (err) {} else {\n            db.close();\n            res.sendStatus(200);\n          }\n        });\n      });\n    } else {\n      res.sendStatus(500);\n    }\n  } else {\n    res.sendStatus(500);\n  }\n});\n\nfunction validateMsg(body) {\n  if (body.msg.length === 0 || body.msg.length > 140) {\n    return false;\n  }\n\n  if (!(typeof body.id == \"number\")) {\n    return false;\n  }\n\n  if (typeof body.state !== \"boolean\") {\n    return false;\n  }\n\n  return true;\n} //------------------------------------------------------------------\n//Mark read\n\n\nrouter.patch('/messages/:id', (req, res) => {\n  let msgId = sanitize(req.params.id); //console.log(\"in patch function with value \" + msgId)\n\n  const regex = new RegExp(/\\D+/);\n\n  if (regex.test(msgId)) {\n    res.sendStatus(400);\n  } else {\n    MongoClient.connect(url, (err, db) => {\n      let dbo = db.db(\"tdp013\");\n      let myquery = {\n        id: msgId\n      };\n      dbo.collection(\"messages\").findOne(myquery, function (err, result) {\n        if (err) {\n          res.sendStatus(500);\n        } else if (result != null) {\n          //If we find a result\n          let newvalues = {\n            $set: {\n              state: !result.state\n            }\n          };\n          dbo.collection(\"messages\").updateOne(myquery, newvalues, function (err, result2) {\n            if (err) {\n              db.close();\n              res.sendStatus(500);\n            } else {\n              db.close();\n              res.sendStatus(200);\n            }\n          });\n        } else {\n          //If we dont find a result\n          res.sendStatus(500);\n          db.close();\n        }\n      });\n    });\n  }\n}); //------------------------------------------------------------------\n//Get all\n\nrouter.get('/messages', (req, res) => {\n  MongoClient.connect(url, (err, db) => {\n    let dbo = db.db(\"tdp013\");\n    dbo.collection('messages').find({}).toArray(function (err, result) {\n      db.close();\n\n      if (err) {//console.log(err)\n      } else if (result != null) {\n        //console.log(result)\n        res.send(result);\n      } else {\n        res.sendStatus(500);\n      }\n    });\n  }); //res.send()\n}); //------------------------------------------------------------------\n// Get one\n\nrouter.get('/messages/:id', (req, res) => {\n  let msgId = sanitize(req.params.id);\n  const regex = new RegExp(/\\D+/);\n\n  if (regex.test(msgId)) {\n    res.sendStatus(400);\n  } else {\n    MongoClient.connect(url, (err, db) => {\n      let dbo = db.db(\"tdp013\");\n      let myquery = {\n        id: msgId\n      };\n      dbo.collection(\"messages\").findOne(myquery, function (err, result) {\n        db.close();\n\n        if (err) {//console.log(err)\n        } else if (result != null) {\n          res.send(result); //.json(result)\n        } else {\n          res.sendStatus(500);\n        }\n      });\n    });\n  }\n});\napp.use(function (req, res) {\n  //console.log(\"found it\")\n  res.send(\"Sorry can't find that!\", 404);\n});\nmodule.exports = router;\n/*använd asynkrona anrop för att hämta och lagra data. \nKan ta in en resolve och reject funktion. \nMed detta kan vi skicka rätt felmeddelanden.\nen backend fil som hanterar logik\nen testfil som representerar klient-logiken \n(alltså om vi klickar på en knapp kommer meddelande x\nskickas t.ex)*/\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImV4cHJlc3MiLCJyZXF1aXJlIiwiYXBwIiwicm91dGVyIiwiUm91dGVyIiwiTW9uZ29DbGllbnQiLCJzYW5pdGl6ZSIsInVybCIsInVzZSIsImpzb24iLCJ1cmxlbmNvZGVkIiwiZXh0ZW5kZWQiLCJhbGwiLCJyZXEiLCJyZXMiLCJuZXh0IiwibWV0aG9kIiwiYm9keSIsInNlbmRTdGF0dXMiLCJwb3N0IiwidmFsaWRhdGVNc2ciLCJtc2ciLCJyZWdleCIsIlJlZ0V4cCIsInRlc3QiLCJjb25uZWN0IiwiZXJyIiwiZGIiLCJkYm8iLCJjb2xsZWN0aW9uIiwiaW5zZXJ0T25lIiwicmVzdWx0IiwiY2xvc2UiLCJsZW5ndGgiLCJpZCIsInN0YXRlIiwicGF0Y2giLCJtc2dJZCIsInBhcmFtcyIsIm15cXVlcnkiLCJmaW5kT25lIiwibmV3dmFsdWVzIiwiJHNldCIsInVwZGF0ZU9uZSIsInJlc3VsdDIiLCJnZXQiLCJmaW5kIiwidG9BcnJheSIsInNlbmQiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQSxJQUFJQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxTQUFELENBQXJCOztBQUNBLE1BQU1DLEdBQUcsR0FBR0YsT0FBTyxFQUFuQjtBQUNBLElBQUlHLE1BQU0sR0FBR0gsT0FBTyxDQUFDSSxNQUFSLEVBQWI7O0FBQ0EsTUFBTTtBQUFDQyxFQUFBQTtBQUFELElBQWdCSixPQUFPLENBQUMsU0FBRCxDQUE3Qjs7QUFDQSxJQUFJSyxRQUFRLEdBQUdMLE9BQU8sQ0FBQyxnQkFBRCxDQUF0Qjs7QUFDQSxJQUFJTSxHQUFHLEdBQUcsNEJBQVY7QUFFQUwsR0FBRyxDQUFDTSxHQUFKLENBQVFSLE9BQU8sQ0FBQ1MsSUFBUixFQUFSO0FBQ0FQLEdBQUcsQ0FBQ00sR0FBSixDQUFRUixPQUFPLENBQUNVLFVBQVIsQ0FBbUI7QUFBRUMsRUFBQUEsUUFBUSxFQUFFO0FBQVosQ0FBbkIsQ0FBUjtBQUdBUixNQUFNLENB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QUNELENBSEQ7QUFNQUMsTUFBTSxDQUFDQyxPQUFQLEdBQWlCL0MsTUFBakI7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIvaG9tZS92aW5haDMzMS9EZXNrdG9wL3RkcDAxMy9sYWIyL3JvdXRlcy8iLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbmNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcbnZhciByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xuY29uc3Qge01vbmdvQ2xpZW50fSA9IHJlcXVpcmUoJ21vbmdvZGInKTtcbmxldCBzYW5pdGl6ZSA9IHJlcXVpcmUoJ21vbmdvLXNhbml0aXplJyk7XG5sZXQgdXJsID0gXCJtb25nb2RiOi8vbG9jYWxob3N0OjI3MDE3L1wiO1xuXG5hcHAudXNlKGV4cHJlc3MuanNvbigpKTtcbmFwcC51c2UoZXhwcmVzcy51cmxlbmNvZGVkKHsgZXh0ZW5kZWQ6IGZhbHNlIH0pKTtcblxuXG5yb3V0ZXIuYWxsKCcvbWVzc2FnZXMnLCBmdW5jdGlvbihyZXEsIHJlcywgbmV4dCkge1xuICBpZihyZXEubWV0aG9kID09IFwiUE9TVFwiIHx8IHJlcS5tZXRob2QgPT0gXCJHRVRcIikge1xuICAgIC8vS29sbGEgb20gZ2V0IGhhciBlbiBib2R5P1xuICAgIGlmIChyZXEubWV0aG9kID09IFwiR0VUXCIgJiYgcmVxLmJvZHkpIHtcbiAgICAgICAgcmVzLnNlbmRTdGF0dXMoNDA1KVxuICAgIH1cbiAgICBuZXh0KCk7XG4gIH0gZWxzZSB7XG4gICAgLy9jb25zb2xlLmxvZyhyZXEubWV0aG9kKVxuICAgIHJlcy5zZW5kU3RhdHVzKDQwNSlcbiAgfVxufSlcblxucm91dGVyLmFsbCgnL21lc3NhZ2VzLzppZCcsIGZ1bmN0aW9uKHJlcSwgcmVzLCBuZXh0KSB7XG4gIC8vY29uc29sZS5sb2coXCIxXCIpXG4gIGlmKHJlcS5tZXRob2QgPT0gXCJQQVRDSFwiIHx8IHJlcS5tZXRob2QgPT0gXCJHRVRcIikge1xuICAgIG5leHQoKTtcbiAgfSBlbHNlIHtcbiAgICByZXMuc2VuZFN0YXR1cyg0MDUpXG4gIH1cbn0pXG5cblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vU2F2ZSBvbmVcblxucm91dGVyLnBvc3QoJy9tZXNzYWdlcycsIChyZXEsIHJlcykgPT4ge1xuICBpZiAodmFsaWRhdGVNc2cocmVxLmJvZHkpKSB7XG4gICAgbXNnID0gc2FuaXRpemUocmVxLmJvZHkpXG4gICAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKC88c2NyaXB0Pi8pICAvL2luamVjdGlvbj9cbiAgICBpZiAoIXJlZ2V4LnRlc3QobXNnKSkge1xuICAgICAgLy9jb25zb2xlLmxvZyhyZXEuYm9keSlcbiAgICAgIE1vbmdvQ2xpZW50LmNvbm5lY3QodXJsLCAoZXJyLCBkYikgPT4ge1xuICAgICAgICBsZXQgZGJvID0gZGIuZGIoXCJ0ZHAwMTNcIik7XG4gICAgICAgIGRiby5jb2xsZWN0aW9uKCdtZXNzYWdlcycpLmluc2VydE9uZShtc2csIGZ1bmN0aW9uKGVyciwgcmVzdWx0KSB7XG4gICAgICAgICAgaWYgKGVycikge31cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGRiLmNsb3NlKCk7XG4gICAgICAgICAgICByZXMuc2VuZFN0YXR1cygyMDApXG4gICAgICAgICAgfVxuXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgcmVzLnNlbmRTdGF0dXMoNTAwKVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICByZXMuc2VuZFN0YXR1cyg1MDApXG4gIH1cbiAgXG59KVxuXG5mdW5jdGlvbiB2YWxpZGF0ZU1zZyhib2R5KSB7XG5cbiAgaWYgKGJvZHkubXNnLmxlbmd0aCA9PT0gMCB8fCBib2R5Lm1zZy5sZW5ndGggPiAxNDApIHsgcmV0dXJuIGZhbHNlIH1cbiAgaWYgKCEodHlwZW9mKGJvZHkuaWQpID09IFwibnVtYmVyXCIpKSAgICAgICAgICAgICAgICAgICAgICAgIHsgcmV0dXJuIGZhbHNlIH1cbiAgaWYgKHR5cGVvZihib2R5LnN0YXRlKSAhPT0gXCJib29sZWFuXCIpICAgICAgICAgICAgICAgICB7IHJldHVybiBmYWxzZSB9XG4gIHJldHVybiB0cnVlXG59XG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vL01hcmsgcmVhZFxucm91dGVyLnBhdGNoKCgnL21lc3NhZ2VzLzppZCcpLCAocmVxLCByZXMpID0+IHtcblxuICBsZXQgbXNnSWQgPSBzYW5pdGl6ZShyZXEucGFyYW1zLmlkKVxuICAvL2NvbnNvbGUubG9nKFwiaW4gcGF0Y2ggZnVuY3Rpb24gd2l0aCB2YWx1ZSBcIiArIG1zZ0lkKVxuICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoL1xcRCsvKVxuXG4gIGlmIChyZWdleC50ZXN0KG1zZ0lkKSkge1xuICAgIHJlcy5zZW5kU3RhdHVzKDQwMClcblxuICB9IGVsc2Uge1xuICAgIE1vbmdvQ2xpZW50LmNvbm5lY3QodXJsLCAoZXJyLCBkYikgPT4ge1xuICAgICAgbGV0IGRibyA9IGRiLmRiKFwidGRwMDEzXCIpO1xuICAgICAgbGV0IG15cXVlcnkgPSB7IGlkOiBtc2dJZCB9O1xuICAgICAgXG4gICAgICBkYm8uY29sbGVjdGlvbihcIm1lc3NhZ2VzXCIpLmZpbmRPbmUobXlxdWVyeSwgZnVuY3Rpb24oZXJyLCByZXN1bHQpIHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIHJlcy5zZW5kU3RhdHVzKDUwMClcbiAgICAgICAgfSBcbiAgICAgICAgZWxzZSBpZiAocmVzdWx0ICE9IG51bGwpIHtcbiAgICAgICAgICAvL0lmIHdlIGZpbmQgYSByZXN1bHRcbiAgICAgICAgICBsZXQgbmV3dmFsdWVzID0geyAkc2V0OiB7c3RhdGU6ICEocmVzdWx0LnN0YXRlKX0gfTtcbiAgICAgICAgICBcbiAgICAgICAgICBkYm8uY29sbGVjdGlvbihcIm1lc3NhZ2VzXCIpLnVwZGF0ZU9uZShteXF1ZXJ5LCBuZXd2YWx1ZXMsIGZ1bmN0aW9uKGVyciwgcmVzdWx0Mikge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICBkYi5jbG9zZSgpO1xuICAgICAgICAgICAgICByZXMuc2VuZFN0YXR1cyg1MDApXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgZGIuY2xvc2UoKTtcbiAgICAgICAgICAgICAgcmVzLnNlbmRTdGF0dXMoMjAwKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9IFxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAvL0lmIHdlIGRvbnQgZmluZCBhIHJlc3VsdFxuICAgICAgICAgIHJlcy5zZW5kU3RhdHVzKDUwMClcbiAgICAgICAgICBkYi5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIFxuICAgIH0pO1xuICB9XG59KVxuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy9HZXQgYWxsXG5yb3V0ZXIuZ2V0KCgnL21lc3NhZ2VzJyksIChyZXEsIHJlcykgPT4ge1xuXG4gIE1vbmdvQ2xpZW50LmNvbm5lY3QodXJsLCAoZXJyLCBkYikgPT4ge1xuICAgIGxldCBkYm8gPSBkYi5kYihcInRkcDAxM1wiKTtcblxuICAgIGRiby5jb2xsZWN0aW9uKCdtZXNzYWdlcycpLmZpbmQoe30pLnRvQXJyYXkoZnVuY3Rpb24oZXJyLCByZXN1bHQpIHtcbiAgICAgIGRiLmNsb3NlKCk7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIC8vY29uc29sZS5sb2coZXJyKVxuICAgICAgfVxuICAgICAgZWxzZSBpZiAocmVzdWx0ICE9IG51bGwpIHtcbiAgICAgICAgLy9jb25zb2xlLmxvZyhyZXN1bHQpXG4gICAgICAgIHJlcy5zZW5kKHJlc3VsdClcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICByZXMuc2VuZFN0YXR1cyg1MDApXG4gICAgICB9XG4gICAgfSlcbiAgICBcbiAgfSlcbiAgLy9yZXMuc2VuZCgpXG59KVxuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gR2V0IG9uZVxucm91dGVyLmdldCgoJy9tZXNzYWdlcy86aWQnKSwgKHJlcSwgcmVzKSA9PiB7XG4gIGxldCBtc2dJZCA9IHNhbml0aXplKHJlcS5wYXJhbXMuaWQpXG4gIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cCgvXFxEKy8pXG4gIGlmIChyZWdleC50ZXN0KG1zZ0lkKSkge1xuICAgIHJlcy5zZW5kU3RhdHVzKDQwMClcbiAgfSBlbHNlIHtcblxuICAgIE1vbmdvQ2xpZW50LmNvbm5lY3QodXJsLCAoZXJyLCBkYikgPT4ge1xuICAgICAgbGV0IGRibyA9IGRiLmRiKFwidGRwMDEzXCIpO1xuICAgICAgbGV0IG15cXVlcnkgPSB7IGlkOiBtc2dJZCB9O1xuXG4gICAgICBkYm8uY29sbGVjdGlvbihcIm1lc3NhZ2VzXCIpLmZpbmRPbmUobXlxdWVyeSwgZnVuY3Rpb24oZXJyLCByZXN1bHQpIHtcbiAgICAgICAgZGIuY2xvc2UoKTtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIC8vY29uc29sZS5sb2coZXJyKVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHJlc3VsdCAhPSBudWxsKSB7XG4gICAgICAgICAgcmVzLnNlbmQocmVzdWx0KS8vLmpzb24ocmVzdWx0KVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHJlcy5zZW5kU3RhdHVzKDUwMClcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cbn0pXG5cbmFwcC51c2UoZnVuY3Rpb24gKHJlcSwgcmVzKSB7XG4gIC8vY29uc29sZS5sb2coXCJmb3VuZCBpdFwiKVxuICByZXMuc2VuZChcIlNvcnJ5IGNhbid0IGZpbmQgdGhhdCFcIiwgNDA0KVxufSlcblxuXG5tb2R1bGUuZXhwb3J0cyA9IHJvdXRlcjtcblxuXG4vKmFudsOkbmQgYXN5bmtyb25hIGFucm9wIGbDtnIgYXR0IGjDpG10YSBvY2ggbGFncmEgZGF0YS4gXG5LYW4gdGEgaW4gZW4gcmVzb2x2ZSBvY2ggcmVqZWN0IGZ1bmt0aW9uLiBcbk1lZCBkZXR0YSBrYW4gdmkgc2tpY2thIHLDpHR0IGZlbG1lZGRlbGFuZGVuLlxuZW4gYmFja2VuZCBmaWwgc29tIGhhbnRlcmFyIGxvZ2lrXG5lbiB0ZXN0ZmlsIHNvbSByZXByZXNlbnRlcmFyIGtsaWVudC1sb2dpa2VuIFxuKGFsbHRzw6Ugb20gdmkga2xpY2thciBww6UgZW4ga25hcHAga29tbWVyIG1lZGRlbGFuZGUgeFxuc2tpY2thcyB0LmV4KSovXG4iXX0=",
    "map": {
      "version": 3,
      "sources": [
        "index.js"
      ],
      "names": [
        "express",
        "require",
        "app",
        "router",
        "Router",
        "MongoClient",
        "sanitize",
        "url",
        "use",
        "json",
        "urlencoded",
        "extended",
        "all",
        "req",
        "res",
        "next",
        "method",
        "body",
        "sendStatus",
        "post",
        "validateMsg",
        "msg",
        "regex",
        "RegExp",
        "test",
        "connect",
        "err",
        "db",
        "dbo",
        "collection",
        "insertOne",
        "result",
        "close",
        "length",
        "id",
        "state",
        "patch",
        "msgId",
        "params",
        "myquery",
        "findOne",
        "newvalues",
        "$set",
        "updateOne",
        "result2",
        "get",
        "find",
        "toArray",
        "send",
        "module",
        "exports"
      ],
      "mappings": "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",
      "sourceRoot": "/home/vinah331/Desktop/tdp013/lab2/routes/",
      "sourcesContent": [
        "var express = require('express');\nconst app = express();\nvar router = express.Router();\nconst {MongoClient} = require('mongodb');\nlet sanitize = require('mongo-sanitize');\nlet url = \"mongodb://localhost:27017/\";\n\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\n\nrouter.all('/messages', function(req, res, next) {\n  if(req.method == \"POST\" || req.method == \"GET\") {\n    //Kolla om get har en body?\n    if (req.method == \"GET\" && req.body) {\n        res.sendStatus(405)\n    }\n    next();\n  } else {\n    //console.log(req.method)\n    res.sendStatus(405)\n  }\n})\n\nrouter.all('/messages/:id', function(req, res, next) {\n  //console.log(\"1\")\n  if(req.method == \"PATCH\" || req.method == \"GET\") {\n    next();\n  } else {\n    res.sendStatus(405)\n  }\n})\n\n\n//------------------------------------------------------------------\n//Save one\n\nrouter.post('/messages', (req, res) => {\n  if (validateMsg(req.body)) {\n    msg = sanitize(req.body)\n    const regex = new RegExp(/<script>/)  //injection?\n    if (!regex.test(msg)) {\n      //console.log(req.body)\n      MongoClient.connect(url, (err, db) => {\n        let dbo = db.db(\"tdp013\");\n        dbo.collection('messages').insertOne(msg, function(err, result) {\n          if (err) {}\n          else {\n            db.close();\n            res.sendStatus(200)\n          }\n\n        });\n      });\n    }\n    else {\n      res.sendStatus(500)\n    }\n  } else {\n    res.sendStatus(500)\n  }\n  \n})\n\nfunction validateMsg(body) {\n\n  if (body.msg.length === 0 || body.msg.length > 140) { return false }\n  if (!(typeof(body.id) == \"number\"))                        { return false }\n  if (typeof(body.state) !== \"boolean\")                 { return false }\n  return true\n}\n\n//------------------------------------------------------------------\n//Mark read\nrouter.patch(('/messages/:id'), (req, res) => {\n\n  let msgId = sanitize(req.params.id)\n  //console.log(\"in patch function with value \" + msgId)\n  const regex = new RegExp(/\\D+/)\n\n  if (regex.test(msgId)) {\n    res.sendStatus(400)\n\n  } else {\n    MongoClient.connect(url, (err, db) => {\n      let dbo = db.db(\"tdp013\");\n      let myquery = { id: msgId };\n      \n      dbo.collection(\"messages\").findOne(myquery, function(err, result) {\n        if (err) {\n          res.sendStatus(500)\n        } \n        else if (result != null) {\n          //If we find a result\n          let newvalues = { $set: {state: !(result.state)} };\n          \n          dbo.collection(\"messages\").updateOne(myquery, newvalues, function(err, result2) {\n            if (err) {\n              db.close();\n              res.sendStatus(500)\n            }\n            else {\n              db.close();\n              res.sendStatus(200)\n            }\n          });\n        } \n        else {\n          //If we dont find a result\n          res.sendStatus(500)\n          db.close();\n        }\n      });\n      \n    });\n  }\n})\n\n//------------------------------------------------------------------\n//Get all\nrouter.get(('/messages'), (req, res) => {\n\n  MongoClient.connect(url, (err, db) => {\n    let dbo = db.db(\"tdp013\");\n\n    dbo.collection('messages').find({}).toArray(function(err, result) {\n      db.close();\n      if (err) {\n        //console.log(err)\n      }\n      else if (result != null) {\n        //console.log(result)\n        res.send(result)\n      }\n      else {\n        res.sendStatus(500)\n      }\n    })\n    \n  })\n  //res.send()\n})\n\n//------------------------------------------------------------------\n// Get one\nrouter.get(('/messages/:id'), (req, res) => {\n  let msgId = sanitize(req.params.id)\n  const regex = new RegExp(/\\D+/)\n  if (regex.test(msgId)) {\n    res.sendStatus(400)\n  } else {\n\n    MongoClient.connect(url, (err, db) => {\n      let dbo = db.db(\"tdp013\");\n      let myquery = { id: msgId };\n\n      dbo.collection(\"messages\").findOne(myquery, function(err, result) {\n        db.close();\n        if (err) {\n          //console.log(err)\n        }\n        else if (result != null) {\n          res.send(result)//.json(result)\n        }\n        else {\n          res.sendStatus(500)\n        }\n      });\n    });\n  }\n})\n\napp.use(function (req, res) {\n  //console.log(\"found it\")\n  res.send(\"Sorry can't find that!\", 404)\n})\n\n\nmodule.exports = router;\n\n\n/*använd asynkrona anrop för att hämta och lagra data. \nKan ta in en resolve och reject funktion. \nMed detta kan vi skicka rätt felmeddelanden.\nen backend fil som hanterar logik\nen testfil som representerar klient-logiken \n(alltså om vi klickar på en knapp kommer meddelande x\nskickas t.ex)*/\n"
      ]
    },
    "sourceType": "module",
    "mtime": 1632488276883
  },
  "{\"assumptions\":{},\"sourceRoot\":\"/home/vinah331/Desktop/tdp013/lab2/routes/\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"/home/vinah331/Desktop/tdp013/lab2\",\"filename\":\"/home/vinah331/Desktop/tdp013/lab2/routes/users.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/home/vinah331/Desktop/tdp013/lab2\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.15.5": {
    "metadata": {},
    "options": {
      "assumptions": {},
      "sourceRoot": "/home/vinah331/Desktop/tdp013/lab2/routes/",
      "caller": {
        "name": "@babel/node"
      },
      "cwd": "/home/vinah331/Desktop/tdp013/lab2",
      "filename": "/home/vinah331/Desktop/tdp013/lab2/routes/users.js",
      "targets": {},
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "browserslistConfigFile": false,
      "envName": "development",
      "root": "/home/vinah331/Desktop/tdp013/lab2",
      "rootMode": "root",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/home/vinah331/Desktop/tdp013/lab2/routes/users.js",
        "plugins": []
      },
      "generatorOpts": {
        "filename": "/home/vinah331/Desktop/tdp013/lab2/routes/users.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/home/vinah331/Desktop/tdp013/lab2/routes/",
        "sourceFileName": "users.js"
      }
    },
    "ast": null,
    "code": "var express = require('express');\n\nvar router = express.Router();\n/* GET users listing. */\n\nrouter.get('/', function (req, res, next) {\n  res.send('respond with a resource');\n});\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZXJzLmpzIl0sIm5hbWVzIjpbImV4cHJlc3MiLCJyZXF1aXJlIiwicm91dGVyIiwiUm91dGVyIiwiZ2V0IiwicmVxIiwicmVzIiwibmV4dCIsInNlbmQiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQSxJQUFJQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxTQUFELENBQXJCOztBQUNBLElBQUlDLE1BQU0sR0FBR0YsT0FBTyxDQUFDRyxNQUFSLEVBQWI7QUFFQTs7QUFDQUQsTUFBTSxDQUFDRSxHQUFQLENBQVcsR0FBWCxFQUFnQixVQUFTQyxHQUFULEVBQWNDLEdBQWQsRUFBbUJDLElBQW5CLEVBQXlCO0FBQ3ZDRCxFQUFBQSxHQUFHLENBQUNFLElBQUosQ0FBUyx5QkFBVDtBQUNELENBRkQ7QUFJQUMsTUFBTSxDQUFDQyxPQUFQLEdBQWlCUixNQUFqQiIsInNvdXJjZVJvb3QiOiIvaG9tZS92aW5haDMzMS9EZXNrdG9wL3RkcDAxMy9sYWIyL3JvdXRlcy8iLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbnZhciByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xuXG4vKiBHRVQgdXNlcnMgbGlzdGluZy4gKi9cbnJvdXRlci5nZXQoJy8nLCBmdW5jdGlvbihyZXEsIHJlcywgbmV4dCkge1xuICByZXMuc2VuZCgncmVzcG9uZCB3aXRoIGEgcmVzb3VyY2UnKTtcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHJvdXRlcjtcbiJdfQ==",
    "map": {
      "version": 3,
      "sources": [
        "users.js"
      ],
      "names": [
        "express",
        "require",
        "router",
        "Router",
        "get",
        "req",
        "res",
        "next",
        "send",
        "module",
        "exports"
      ],
      "mappings": "AAAA,IAAIA,OAAO,GAAGC,OAAO,CAAC,SAAD,CAArB;;AACA,IAAIC,MAAM,GAAGF,OAAO,CAACG,MAAR,EAAb;AAEA;;AACAD,MAAM,CAACE,GAAP,CAAW,GAAX,EAAgB,UAASC,GAAT,EAAcC,GAAd,EAAmBC,IAAnB,EAAyB;AACvCD,EAAAA,GAAG,CAACE,IAAJ,CAAS,yBAAT;AACD,CAFD;AAIAC,MAAM,CAACC,OAAP,GAAiBR,MAAjB",
      "sourceRoot": "/home/vinah331/Desktop/tdp013/lab2/routes/",
      "sourcesContent": [
        "var express = require('express');\nvar router = express.Router();\n\n/* GET users listing. */\nrouter.get('/', function(req, res, next) {\n  res.send('respond with a resource');\n});\n\nmodule.exports = router;\n"
      ]
    },
    "sourceType": "module",
    "mtime": 1631534435311
  }
}