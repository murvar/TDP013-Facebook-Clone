function cov_23szk0d1c9(){var path="/home/vinah331/Desktop/tdp013/lab3/routes/index.js";var hash="78ebe444476c29c994bb416337847d704937ba78";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/vinah331/Desktop/tdp013/lab3/routes/index.js",statementMap:{"0":{start:{line:1,column:14},end:{line:1,column:32}},"1":{start:{line:2,column:12},end:{line:2,column:21}},"2":{start:{line:3,column:13},end:{line:3,column:29}},"3":{start:{line:4,column:22},end:{line:4,column:40}},"4":{start:{line:5,column:15},end:{line:5,column:40}},"5":{start:{line:6,column:10},end:{line:6,column:38}},"6":{start:{line:8,column:0},end:{line:8,column:24}},"7":{start:{line:9,column:0},end:{line:9,column:49}},"8":{start:{line:12,column:0},end:{line:26,column:2}},"9":{start:{line:13,column:2},end:{line:13,column:23}},"10":{start:{line:14,column:2},end:{line:25,column:3}},"11":{start:{line:16,column:4},end:{line:19,column:5}},"12":{start:{line:17,column:6},end:{line:17,column:35}},"13":{start:{line:18,column:6},end:{line:18,column:25}},"14":{start:{line:20,column:4},end:{line:20,column:11}},"15":{start:{line:23,column:4},end:{line:23,column:41}},"16":{start:{line:24,column:4},end:{line:24,column:23}},"17":{start:{line:28,column:0},end:{line:35,column:2}},"18":{start:{line:30,column:2},end:{line:34,column:3}},"19":{start:{line:31,column:4},end:{line:31,column:11}},"20":{start:{line:33,column:4},end:{line:33,column:23}},"21":{start:{line:41,column:0},end:{line:65,column:2}},"22":{start:{line:42,column:2},end:{line:42,column:23}},"23":{start:{line:43,column:2},end:{line:64,column:3}},"24":{start:{line:44,column:4},end:{line:44,column:28}},"25":{start:{line:45,column:18},end:{line:45,column:40}},"26":{start:{line:46,column:4},end:{line:61,column:5}},"27":{start:{line:47,column:6},end:{line:57,column:9}},"28":{start:{line:48,column:18},end:{line:48,column:33}},"29":{start:{line:49,column:8},end:{line:56,column:11}},"30":{start:{line:50,column:10},end:{line:54,column:11}},"31":{start:{line:50,column:20},end:{line:50,column:29}},"32":{start:{line:52,column:12},end:{line:52,column:23}},"33":{start:{line:53,column:12},end:{line:53,column:31}},"34":{start:{line:60,column:6},end:{line:60,column:25}},"35":{start:{line:63,column:4},end:{line:63,column:23}},"36":{start:{line:68,column:2},end:{line:68,column:70}},"37":{start:{line:68,column:56},end:{line:68,column:68}},"38":{start:{line:69,column:2},end:{line:69,column:78}},"39":{start:{line:69,column:64},end:{line:69,column:76}},"40":{start:{line:70,column:2},end:{line:70,column:72}},"41":{start:{line:70,column:58},end:{line:70,column:70}},"42":{start:{line:71,column:2},end:{line:71,column:13}},"43":{start:{line:76,column:0},end:{line:112,column:2}},"44":{start:{line:77,column:2},end:{line:77,column:21}},"45":{start:{line:78,column:14},end:{line:78,column:37}},"46":{start:{line:81,column:2},end:{line:111,column:5}},"47":{start:{line:82,column:14},end:{line:82,column:29}},"48":{start:{line:83,column:18},end:{line:83,column:31}},"49":{start:{line:85,column:4},end:{line:109,column:7}},"50":{start:{line:86,column:6},end:{line:108,column:7}},"51":{start:{line:87,column:8},end:{line:87,column:27}},"52":{start:{line:89,column:11},end:{line:108,column:7}},"53":{start:{line:91,column:24},end:{line:91,column:58}},"54":{start:{line:93,column:8},end:{line:102,column:11}},"55":{start:{line:94,column:10},end:{line:101,column:11}},"56":{start:{line:95,column:12},end:{line:95,column:23}},"57":{start:{line:96,column:12},end:{line:96,column:31}},"58":{start:{line:99,column:12},end:{line:99,column:22}},"59":{start:{line:100,column:12},end:{line:100,column:31}},"60":{start:{line:106,column:8},end:{line:106,column:27}},"61":{start:{line:107,column:8},end:{line:107,column:19}},"62":{start:{line:116,column:0},end:{line:136,column:2}},"63":{start:{line:118,column:2},end:{line:135,column:4}},"64":{start:{line:119,column:14},end:{line:119,column:29}},"65":{start:{line:121,column:4},end:{line:133,column:6}},"66":{start:{line:122,column:6},end:{line:122,column:17}},"67":{start:{line:123,column:6},end:{line:132,column:7}},"68":{start:{line:126,column:11},end:{line:132,column:7}},"69":{start:{line:127,column:8},end:{line:127,column:27}},"70":{start:{line:128,column:8},end:{line:128,column:24}},"71":{start:{line:131,column:8},end:{line:131,column:27}},"72":{start:{line:140,column:0},end:{line:165,column:2}},"73":{start:{line:141,column:14},end:{line:141,column:37}},"74":{start:{line:142,column:2},end:{line:142,column:29}},"75":{start:{line:143,column:2},end:{line:164,column:3}},"76":{start:{line:144,column:4},end:{line:144,column:23}},"77":{start:{line:147,column:4},end:{line:163,column:7}},"78":{start:{line:148,column:16},end:{line:148,column:31}},"79":{start:{line:149,column:20},end:{line:149,column:33}},"80":{start:{line:151,column:6},end:{line:162,column:9}},"81":{start:{line:152,column:8},end:{line:152,column:19}},"82":{start:{line:153,column:8},end:{line:161,column:9}},"83":{start:{line:156,column:13},end:{line:161,column:9}},"84":{start:{line:157,column:10},end:{line:157,column:26}},"85":{start:{line:160,column:10},end:{line:160,column:29}},"86":{start:{line:167,column:0},end:{line:170,column:2}},"87":{start:{line:169,column:2},end:{line:169,column:41}},"88":{start:{line:173,column:0},end:{line:173,column:24}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:12,column:24},end:{line:12,column:25}},loc:{start:{line:12,column:49},end:{line:26,column:1}},line:12},"1":{name:"(anonymous_1)",decl:{start:{line:28,column:28},end:{line:28,column:29}},loc:{start:{line:28,column:53},end:{line:35,column:1}},line:28},"2":{name:"(anonymous_2)",decl:{start:{line:41,column:25},end:{line:41,column:26}},loc:{start:{line:41,column:39},end:{line:65,column:1}},line:41},"3":{name:"(anonymous_3)",decl:{start:{line:47,column:31},end:{line:47,column:32}},loc:{start:{line:47,column:44},end:{line:57,column:7}},line:47},"4":{name:"(anonymous_4)",decl:{start:{line:49,column:50},end:{line:49,column:51}},loc:{start:{line:49,column:72},end:{line:56,column:9}},line:49},"5":{name:"validateMsg",decl:{start:{line:67,column:9},end:{line:67,column:20}},loc:{start:{line:67,column:27},end:{line:72,column:1}},line:67},"6":{name:"(anonymous_6)",decl:{start:{line:76,column:32},end:{line:76,column:33}},loc:{start:{line:76,column:46},end:{line:112,column:1}},line:76},"7":{name:"(anonymous_7)",decl:{start:{line:81,column:27},end:{line:81,column:28}},loc:{start:{line:81,column:40},end:{line:111,column:3}},line:81},"8":{name:"(anonymous_8)",decl:{start:{line:85,column:48},end:{line:85,column:49}},loc:{start:{line:85,column:70},end:{line:109,column:5}},line:85},"9":{name:"(anonymous_9)",decl:{start:{line:93,column:65},end:{line:93,column:66}},loc:{start:{line:93,column:88},end:{line:102,column:9}},line:93},"10":{name:"(anonymous_10)",decl:{start:{line:116,column:26},end:{line:116,column:27}},loc:{start:{line:116,column:40},end:{line:136,column:1}},line:116},"11":{name:"(anonymous_11)",decl:{start:{line:118,column:27},end:{line:118,column:28}},loc:{start:{line:118,column:40},end:{line:135,column:3}},line:118},"12":{name:"(anonymous_12)",decl:{start:{line:121,column:46},end:{line:121,column:47}},loc:{start:{line:121,column:68},end:{line:133,column:5}},line:121},"13":{name:"(anonymous_13)",decl:{start:{line:140,column:30},end:{line:140,column:31}},loc:{start:{line:140,column:44},end:{line:165,column:1}},line:140},"14":{name:"(anonymous_14)",decl:{start:{line:147,column:29},end:{line:147,column:30}},loc:{start:{line:147,column:42},end:{line:163,column:5}},line:147},"15":{name:"(anonymous_15)",decl:{start:{line:151,column:50},end:{line:151,column:51}},loc:{start:{line:151,column:72},end:{line:162,column:7}},line:151},"16":{name:"(anonymous_16)",decl:{start:{line:167,column:8},end:{line:167,column:9}},loc:{start:{line:167,column:28},end:{line:170,column:1}},line:167}},branchMap:{"0":{loc:{start:{line:14,column:2},end:{line:25,column:3}},type:"if",locations:[{start:{line:14,column:2},end:{line:25,column:3}},{start:{line:14,column:2},end:{line:25,column:3}}],line:14},"1":{loc:{start:{line:14,column:5},end:{line:14,column:48}},type:"binary-expr",locations:[{start:{line:14,column:5},end:{line:14,column:25}},{start:{line:14,column:29},end:{line:14,column:48}}],line:14},"2":{loc:{start:{line:16,column:4},end:{line:19,column:5}},type:"if",locations:[{start:{line:16,column:4},end:{line:19,column:5}},{start:{line:16,column:4},end:{line:19,column:5}}],line:16},"3":{loc:{start:{line:16,column:8},end:{line:16,column:45}},type:"binary-expr",locations:[{start:{line:16,column:8},end:{line:16,column:27}},{start:{line:16,column:31},end:{line:16,column:45}}],line:16},"4":{loc:{start:{line:30,column:2},end:{line:34,column:3}},type:"if",locations:[{start:{line:30,column:2},end:{line:34,column:3}},{start:{line:30,column:2},end:{line:34,column:3}}],line:30},"5":{loc:{start:{line:30,column:5},end:{line:30,column:49}},type:"binary-expr",locations:[{start:{line:30,column:5},end:{line:30,column:26}},{start:{line:30,column:30},end:{line:30,column:49}}],line:30},"6":{loc:{start:{line:43,column:2},end:{line:64,column:3}},type:"if",locations:[{start:{line:43,column:2},end:{line:64,column:3}},{start:{line:43,column:2},end:{line:64,column:3}}],line:43},"7":{loc:{start:{line:46,column:4},end:{line:61,column:5}},type:"if",locations:[{start:{line:46,column:4},end:{line:61,column:5}},{start:{line:46,column:4},end:{line:61,column:5}}],line:46},"8":{loc:{start:{line:50,column:10},end:{line:54,column:11}},type:"if",locations:[{start:{line:50,column:10},end:{line:54,column:11}},{start:{line:50,column:10},end:{line:54,column:11}}],line:50},"9":{loc:{start:{line:68,column:2},end:{line:68,column:70}},type:"if",locations:[{start:{line:68,column:2},end:{line:68,column:70}},{start:{line:68,column:2},end:{line:68,column:70}}],line:68},"10":{loc:{start:{line:68,column:6},end:{line:68,column:52}},type:"binary-expr",locations:[{start:{line:68,column:6},end:{line:68,column:27}},{start:{line:68,column:31},end:{line:68,column:52}}],line:68},"11":{loc:{start:{line:69,column:2},end:{line:69,column:78}},type:"if",locations:[{start:{line:69,column:2},end:{line:69,column:78}},{start:{line:69,column:2},end:{line:69,column:78}}],line:69},"12":{loc:{start:{line:70,column:2},end:{line:70,column:72}},type:"if",locations:[{start:{line:70,column:2},end:{line:70,column:72}},{start:{line:70,column:2},end:{line:70,column:72}}],line:70},"13":{loc:{start:{line:86,column:6},end:{line:108,column:7}},type:"if",locations:[{start:{line:86,column:6},end:{line:108,column:7}},{start:{line:86,column:6},end:{line:108,column:7}}],line:86},"14":{loc:{start:{line:89,column:11},end:{line:108,column:7}},type:"if",locations:[{start:{line:89,column:11},end:{line:108,column:7}},{start:{line:89,column:11},end:{line:108,column:7}}],line:89},"15":{loc:{start:{line:94,column:10},end:{line:101,column:11}},type:"if",locations:[{start:{line:94,column:10},end:{line:101,column:11}},{start:{line:94,column:10},end:{line:101,column:11}}],line:94},"16":{loc:{start:{line:123,column:6},end:{line:132,column:7}},type:"if",locations:[{start:{line:123,column:6},end:{line:132,column:7}},{start:{line:123,column:6},end:{line:132,column:7}}],line:123},"17":{loc:{start:{line:126,column:11},end:{line:132,column:7}},type:"if",locations:[{start:{line:126,column:11},end:{line:132,column:7}},{start:{line:126,column:11},end:{line:132,column:7}}],line:126},"18":{loc:{start:{line:143,column:2},end:{line:164,column:3}},type:"if",locations:[{start:{line:143,column:2},end:{line:164,column:3}},{start:{line:143,column:2},end:{line:164,column:3}}],line:143},"19":{loc:{start:{line:153,column:8},end:{line:161,column:9}},type:"if",locations:[{start:{line:153,column:8},end:{line:161,column:9}},{start:{line:153,column:8},end:{line:161,column:9}}],line:153},"20":{loc:{start:{line:156,column:13},end:{line:161,column:9}},type:"if",locations:[{start:{line:156,column:13},end:{line:161,column:9}},{start:{line:156,column:13},end:{line:161,column:9}}],line:156}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"78ebe444476c29c994bb416337847d704937ba78"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_23szk0d1c9=function(){return actualCoverage;};}return actualCoverage;}cov_23szk0d1c9();var express=(cov_23szk0d1c9().s[0]++,require('express'));const app=(cov_23szk0d1c9().s[1]++,express());var router=(cov_23szk0d1c9().s[2]++,express.Router());const{MongoClient}=(cov_23szk0d1c9().s[3]++,require('mongodb'));let sanitize=(cov_23szk0d1c9().s[4]++,require('mongo-sanitize'));let url=(cov_23szk0d1c9().s[5]++,"mongodb://localhost:27017/");cov_23szk0d1c9().s[6]++;app.use(express.json());cov_23szk0d1c9().s[7]++;app.use(express.urlencoded({extended:false}));cov_23szk0d1c9().s[8]++;router.all('/messages',function(req,res,next){cov_23szk0d1c9().f[0]++;cov_23szk0d1c9().s[9]++;console.log(req.body);cov_23szk0d1c9().s[10]++;if((cov_23szk0d1c9().b[1][0]++,req.method=="POST")||(cov_23szk0d1c9().b[1][1]++,req.method=="GET")){cov_23szk0d1c9().b[0][0]++;cov_23szk0d1c9().s[11]++;//Kolla om get har en body?
if((cov_23szk0d1c9().b[3][0]++,req.method=="GET")&&(cov_23szk0d1c9().b[3][1]++,req.body=={})){cov_23szk0d1c9().b[2][0]++;cov_23szk0d1c9().s[12]++;//Hur funkar det här???
console.log("failed get all");cov_23szk0d1c9().s[13]++;res.sendStatus(405);}else{cov_23szk0d1c9().b[2][1]++;}cov_23szk0d1c9().s[14]++;next();}else{cov_23szk0d1c9().b[0][1]++;cov_23szk0d1c9().s[15]++;//console.log(req.method)
console.log("another failed get all");cov_23szk0d1c9().s[16]++;res.sendStatus(405);}});cov_23szk0d1c9().s[17]++;router.all('/messages/:id',function(req,res,next){cov_23szk0d1c9().f[1]++;cov_23szk0d1c9().s[18]++;//console.log("1")
if((cov_23szk0d1c9().b[5][0]++,req.method=="PATCH")||(cov_23szk0d1c9().b[5][1]++,req.method=="GET")){cov_23szk0d1c9().b[4][0]++;cov_23szk0d1c9().s[19]++;next();}else{cov_23szk0d1c9().b[4][1]++;cov_23szk0d1c9().s[20]++;res.sendStatus(405);}});//------------------------------------------------------------------
//Save one
cov_23szk0d1c9().s[21]++;router.post('/messages',(req,res)=>{cov_23szk0d1c9().f[2]++;cov_23szk0d1c9().s[22]++;console.log(req.body);cov_23szk0d1c9().s[23]++;if(validateMsg(req.body)){cov_23szk0d1c9().b[6][0]++;cov_23szk0d1c9().s[24]++;msg=sanitize(req.body);const regex=(cov_23szk0d1c9().s[25]++,new RegExp(/<script>/));//injection?
cov_23szk0d1c9().s[26]++;if(!regex.test(msg)){cov_23szk0d1c9().b[7][0]++;cov_23szk0d1c9().s[27]++;MongoClient.connect(url,(err,db)=>{cov_23szk0d1c9().f[3]++;let dbo=(cov_23szk0d1c9().s[28]++,db.db("tdp013"));cov_23szk0d1c9().s[29]++;dbo.collection('messages').insertOne(msg,function(err,result){cov_23szk0d1c9().f[4]++;cov_23szk0d1c9().s[30]++;if(err){cov_23szk0d1c9().b[8][0]++;cov_23szk0d1c9().s[31]++;throw err;}else{cov_23szk0d1c9().b[8][1]++;cov_23szk0d1c9().s[32]++;db.close();cov_23szk0d1c9().s[33]++;res.sendStatus(200);}});});}else{cov_23szk0d1c9().b[7][1]++;cov_23szk0d1c9().s[34]++;res.sendStatus(500);}}else{cov_23szk0d1c9().b[6][1]++;cov_23szk0d1c9().s[35]++;res.sendStatus(500);}});function validateMsg(body){cov_23szk0d1c9().f[5]++;cov_23szk0d1c9().s[36]++;if((cov_23szk0d1c9().b[10][0]++,body.msg.length===0)||(cov_23szk0d1c9().b[10][1]++,body.msg.length>140)){cov_23szk0d1c9().b[9][0]++;cov_23szk0d1c9().s[37]++;return false;}else{cov_23szk0d1c9().b[9][1]++;}cov_23szk0d1c9().s[38]++;if(!(typeof body.id==="string")){cov_23szk0d1c9().b[11][0]++;cov_23szk0d1c9().s[39]++;return false;}else{cov_23szk0d1c9().b[11][1]++;}cov_23szk0d1c9().s[40]++;if(typeof body.state!=="boolean"){cov_23szk0d1c9().b[12][0]++;cov_23szk0d1c9().s[41]++;return false;}else{cov_23szk0d1c9().b[12][1]++;}cov_23szk0d1c9().s[42]++;return true;}//------------------------------------------------------------------
//Mark read
cov_23szk0d1c9().s[43]++;router.patch('/messages/:id',(req,res)=>{cov_23szk0d1c9().f[6]++;cov_23szk0d1c9().s[44]++;console.log("HERE");let msgId=(cov_23szk0d1c9().s[45]++,sanitize(req.params.id));//console.log("in patch function with value " + msgId)
cov_23szk0d1c9().s[46]++;MongoClient.connect(url,(err,db)=>{cov_23szk0d1c9().f[7]++;let dbo=(cov_23szk0d1c9().s[47]++,db.db("tdp013"));let myquery=(cov_23szk0d1c9().s[48]++,{id:msgId});cov_23szk0d1c9().s[49]++;dbo.collection("messages").findOne(myquery,function(err,result){cov_23szk0d1c9().f[8]++;cov_23szk0d1c9().s[50]++;if(err){cov_23szk0d1c9().b[13][0]++;cov_23szk0d1c9().s[51]++;res.sendStatus(500);}else{cov_23szk0d1c9().b[13][1]++;cov_23szk0d1c9().s[52]++;if(result!=null){cov_23szk0d1c9().b[14][0]++;//If we find a result
let newvalues=(cov_23szk0d1c9().s[53]++,{$set:{state:!result.state}});cov_23szk0d1c9().s[54]++;dbo.collection("messages").updateOne(myquery,newvalues,function(err,result2){cov_23szk0d1c9().f[9]++;cov_23szk0d1c9().s[55]++;if(err){cov_23szk0d1c9().b[15][0]++;cov_23szk0d1c9().s[56]++;db.close();cov_23szk0d1c9().s[57]++;res.sendStatus(500);}else{cov_23szk0d1c9().b[15][1]++;cov_23szk0d1c9().s[58]++;db.close();cov_23szk0d1c9().s[59]++;res.sendStatus(200);}});}else{cov_23szk0d1c9().b[14][1]++;cov_23szk0d1c9().s[60]++;//If we dont find a result
res.sendStatus(500);cov_23szk0d1c9().s[61]++;db.close();}}});});});//------------------------------------------------------------------
//Get all
cov_23szk0d1c9().s[62]++;router.get('/messages',(req,res)=>{cov_23szk0d1c9().f[10]++;cov_23szk0d1c9().s[63]++;MongoClient.connect(url,(err,db)=>{cov_23szk0d1c9().f[11]++;let dbo=(cov_23szk0d1c9().s[64]++,db.db("tdp013"));cov_23szk0d1c9().s[65]++;dbo.collection('messages').find().toArray(function(err,result){cov_23szk0d1c9().f[12]++;cov_23szk0d1c9().s[66]++;db.close();cov_23szk0d1c9().s[67]++;if(err){//console.log(err)
cov_23szk0d1c9().b[16][0]++;}else{cov_23szk0d1c9().b[16][1]++;cov_23szk0d1c9().s[68]++;if(result!=null){cov_23szk0d1c9().b[17][0]++;cov_23szk0d1c9().s[69]++;console.log(result);cov_23szk0d1c9().s[70]++;res.send(result);}else{cov_23szk0d1c9().b[17][1]++;cov_23szk0d1c9().s[71]++;res.sendStatus(500);}}});});});//------------------------------------------------------------------
// Get one
cov_23szk0d1c9().s[72]++;router.get('/messages/:id',(req,res)=>{cov_23szk0d1c9().f[13]++;let msgId=(cov_23szk0d1c9().s[73]++,sanitize(req.params.id));cov_23szk0d1c9().s[74]++;console.log("ID: "+msgId);cov_23szk0d1c9().s[75]++;if(typeof msgId!="string"){cov_23szk0d1c9().b[18][0]++;cov_23szk0d1c9().s[76]++;res.sendStatus(400);}else{cov_23szk0d1c9().b[18][1]++;cov_23szk0d1c9().s[77]++;MongoClient.connect(url,(err,db)=>{cov_23szk0d1c9().f[14]++;let dbo=(cov_23szk0d1c9().s[78]++,db.db("tdp013"));let myquery=(cov_23szk0d1c9().s[79]++,{id:msgId});cov_23szk0d1c9().s[80]++;dbo.collection("messages").findOne(myquery,function(err,result){cov_23szk0d1c9().f[15]++;cov_23szk0d1c9().s[81]++;db.close();cov_23szk0d1c9().s[82]++;if(err){//console.log(err)
cov_23szk0d1c9().b[19][0]++;}else{cov_23szk0d1c9().b[19][1]++;cov_23szk0d1c9().s[83]++;if(result!=null){cov_23szk0d1c9().b[20][0]++;cov_23szk0d1c9().s[84]++;res.json(result);//.json(result)
}else{cov_23szk0d1c9().b[20][1]++;cov_23szk0d1c9().s[85]++;res.sendStatus(500);}}});});}});cov_23szk0d1c9().s[86]++;app.use(function(req,res){cov_23szk0d1c9().f[16]++;cov_23szk0d1c9().s[87]++;//console.log("found it")
res.send("Sorry can't find that!",404);});cov_23szk0d1c9().s[88]++;module.exports=router;/*använd asynkrona anrop för att hämta och lagra data. 
Kan ta in en resolve och reject funktion. 
Med detta kan vi skicka rätt felmeddelanden.
en backend fil som hanterar logik
en testfil som representerar klient-logiken 
(alltså om vi klickar på en knapp kommer meddelande x
skickas t.ex)*/
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImV4cHJlc3MiLCJyZXF1aXJlIiwiYXBwIiwicm91dGVyIiwiUm91dGVyIiwiTW9uZ29DbGllbnQiLCJzYW5pdGl6ZSIsInVybCIsInVzZSIsImpzb24iLCJ1cmxlbmNvZGVkIiwiZXh0ZW5kZWQiLCJhbGwiLCJyZXEiLCJyZXMiLCJuZXh0IiwiY29uc29sZSIsImxvZyIsImJvZHkiLCJtZXRob2QiLCJzZW5kU3RhdHVzIiwicG9zdCIsInZhbGlkYXRlTXNnIiwibXNnIiwicmVnZXgiLCJSZWdFeHAiLCJ0ZXN0IiwiY29ubmVjdCIsImVyciIsImRiIiwiZGJvIiwiY29sbGVjdGlvbiIsImluc2VydE9uZSIsInJlc3VsdCIsImNsb3NlIiwibGVuZ3RoIiwiaWQiLCJzdGF0ZSIsInBhdGNoIiwibXNnSWQiLCJwYXJhbXMiLCJteXF1ZXJ5IiwiZmluZE9uZSIsIm5ld3ZhbHVlcyIsIiRzZXQiLCJ1cGRhdGVPbmUiLCJyZXN1bHQyIiwiZ2V0IiwiZmluZCIsInRvQXJyYXkiLCJzZW5kIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6InU3WkFlWTsyRkFmWixHQUFJQSxDQUFBQSxPQUFPLDBCQUFHQyxPQUFPLENBQUMsU0FBRCxDQUFWLENBQVgsQ0FDQSxLQUFNQyxDQUFBQSxHQUFHLDBCQUFHRixPQUFPLEVBQVYsQ0FBVCxDQUNBLEdBQUlHLENBQUFBLE1BQU0sMEJBQUdILE9BQU8sQ0FBQ0ksTUFBUixFQUFILENBQVYsQ0FDQSxLQUFNLENBQUNDLFdBQUQsMkJBQWdCSixPQUFPLENBQUMsU0FBRCxDQUF2QixDQUFOLENBQ0EsR0FBSUssQ0FBQUEsUUFBUSwwQkFBR0wsT0FBTyxDQUFDLGdCQUFELENBQVYsQ0FBWixDQUNBLEdBQUlNLENBQUFBLEdBQUcsMEJBQUcsNEJBQUgsQ0FBUCxDLHdCQUVBTCxHQUFHLENBQUNNLEdBQUosQ0FBUVIsT0FBTyxDQUFDUyxJQUFSLEVBQVIsRSx3QkFDQVAsR0FBRyxDQUFDTSxH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QUgsR0FEZ0UseUJBRWhFLEdBQUlOLEdBQUosQ0FBUyxDQUNQO0FBRE8sNEJBRVIsQ0FGRCxJQUdLLHlEQUFJSyxNQUFNLEVBQUksSUFBZCxDQUFvQixzREFDdkJuQixHQUFHLENBQUNMLElBQUosQ0FBU3dCLE1BQVQsRUFBZ0I7QUFDakIsQ0FGSSxJQUdBLHNEQUNIbkIsR0FBRyxDQUFDTSxVQUFKLENBQWUsR0FBZixFQUNELEVBQ0YsQ0FYRCxFQVlELENBaEJELEVBaUJELENBQ0YsQ0F6QkQsRSx5QkEyQkFsQixHQUFHLENBQUNNLEdBQUosQ0FBUSxTQUFVSyxHQUFWLENBQWVDLEdBQWYsQ0FBb0IsbURBQzFCO0FBQ0FBLEdBQUcsQ0FBQ29DLElBQUosQ0FBUyx3QkFBVCxDQUFtQyxHQUFuQyxFQUNELENBSEQsRSx5QkFNQUMsTUFBTSxDQUFDQyxPQUFQLENBQWlCakQsTUFBakIsQ0FHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZXNDb250ZW50IjpbInZhciBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xuY29uc3QgYXBwID0gZXhwcmVzcygpO1xudmFyIHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG5jb25zdCB7TW9uZ29DbGllbnR9ID0gcmVxdWlyZSgnbW9uZ29kYicpO1xubGV0IHNhbml0aXplID0gcmVxdWlyZSgnbW9uZ28tc2FuaXRpemUnKTtcbmxldCB1cmwgPSBcIm1vbmdvZGI6Ly9sb2NhbGhvc3Q6MjcwMTcvXCI7XG5cbmFwcC51c2UoZXhwcmVzcy5qc29uKCkpO1xuYXBwLnVzZShleHByZXNzLnVybGVuY29kZWQoeyBleHRlbmRlZDogZmFsc2UgfSkpO1xuXG5cbnJvdXRlci5hbGwoJy9tZXNzYWdlcycsIGZ1bmN0aW9uKHJlcSwgcmVzLCBuZXh0KSB7XG4gIGNvbnNvbGUubG9nKHJlcS5ib2R5KVxuICBpZihyZXEubWV0aG9kID09IFwiUE9TVFwiIHx8IHJlcS5tZXRob2QgPT0gXCJHRVRcIikge1xuICAgIC8vS29sbGEgb20gZ2V0IGhhciBlbiBib2R5P1xuICAgIGlmIChyZXEubWV0aG9kID09IFwiR0VUXCIgJiYgcmVxLmJvZHkgPT0ge30pIHsgLy9IdXIgZnVua2FyIGRldCBow6RyPz8/XG4gICAgICBjb25zb2xlLmxvZyhcImZhaWxlZCBnZXQgYWxsXCIpXG4gICAgICByZXMuc2VuZFN0YXR1cyg0MDUpXG4gICAgfVxuICAgIG5leHQoKTtcbiAgfSBlbHNlIHtcbiAgICAvL2NvbnNvbGUubG9nKHJlcS5tZXRob2QpXG4gICAgY29uc29sZS5sb2coXCJhbm90aGVyIGZhaWxlZCBnZXQgYWxsXCIpXG4gICAgcmVzLnNlbmRTdGF0dXMoNDA1KVxuICB9XG59KVxuXG5yb3V0ZXIuYWxsKCcvbWVzc2FnZXMvOmlkJywgZnVuY3Rpb24ocmVxLCByZXMsIG5leHQpIHtcbiAgLy9jb25zb2xlLmxvZyhcIjFcIilcbiAgaWYocmVxLm1ldGhvZCA9PSBcIlBBVENIXCIgfHwgcmVxLm1ldGhvZCA9PSBcIkdFVFwiKSB7XG4gICAgbmV4dCgpO1xuICB9IGVsc2Uge1xuICAgIHJlcy5zZW5kU3RhdHVzKDQwNSlcbiAgfVxufSlcblxuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy9TYXZlIG9uZVxuXG5yb3V0ZXIucG9zdCgnL21lc3NhZ2VzJywgKHJlcSwgcmVzKSA9PiB7XG4gIGNvbnNvbGUubG9nKHJlcS5ib2R5KVxuICBpZiAodmFsaWRhdGVNc2cocmVxLmJvZHkpKSB7XG4gICAgbXNnID0gc2FuaXRpemUocmVxLmJvZHkpXG4gICAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKC88c2NyaXB0Pi8pICAvL2luamVjdGlvbj9cbiAgICBpZiAoIXJlZ2V4LnRlc3QobXNnKSkge1xuICAgICAgTW9uZ29DbGllbnQuY29ubmVjdCh1cmwsIChlcnIsIGRiKSA9PiB7XG4gICAgICAgIGxldCBkYm8gPSBkYi5kYihcInRkcDAxM1wiKTtcbiAgICAgICAgZGJvLmNvbGxlY3Rpb24oJ21lc3NhZ2VzJykuaW5zZXJ0T25lKG1zZywgZnVuY3Rpb24oZXJyLCByZXN1bHQpIHtcbiAgICAgICAgICBpZiAoZXJyKSB7dGhyb3cgZXJyfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZGIuY2xvc2UoKTtcbiAgICAgICAgICAgIHJlcy5zZW5kU3RhdHVzKDIwMClcbiAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICByZXMuc2VuZFN0YXR1cyg1MDApXG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHJlcy5zZW5kU3RhdHVzKDUwMClcbiAgfVxufSlcblxuZnVuY3Rpb24gdmFsaWRhdGVNc2coYm9keSkge1xuICBpZiAoYm9keS5tc2cubGVuZ3RoID09PSAwIHx8IGJvZHkubXNnLmxlbmd0aCA+IDE0MCkgeyByZXR1cm4gZmFsc2UgfVxuICBpZiAoISh0eXBlb2YoYm9keS5pZCkgPT09IFwic3RyaW5nXCIpKSAgICAgICAgICAgICAgICAgICAgICAgIHsgcmV0dXJuIGZhbHNlIH1cbiAgaWYgKHR5cGVvZihib2R5LnN0YXRlKSAhPT0gXCJib29sZWFuXCIpICAgICAgICAgICAgICAgICB7IHJldHVybiBmYWxzZSB9XG4gIHJldHVybiB0cnVlXG59XG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vL01hcmsgcmVhZFxucm91dGVyLnBhdGNoKCgnL21lc3NhZ2VzLzppZCcpLCAocmVxLCByZXMpID0+IHtcbiAgY29uc29sZS5sb2coXCJIRVJFXCIpXG4gIGxldCBtc2dJZCA9IHNhbml0aXplKHJlcS5wYXJhbXMuaWQpXG4gIC8vY29uc29sZS5sb2coXCJpbiBwYXRjaCBmdW5jdGlvbiB3aXRoIHZhbHVlIFwiICsgbXNnSWQpXG5cbiAgTW9uZ29DbGllbnQuY29ubmVjdCh1cmwsIChlcnIsIGRiKSA9PiB7XG4gICAgbGV0IGRibyA9IGRiLmRiKFwidGRwMDEzXCIpO1xuICAgIGxldCBteXF1ZXJ5ID0geyBpZDogbXNnSWQgfTtcbiAgICBcbiAgICBkYm8uY29sbGVjdGlvbihcIm1lc3NhZ2VzXCIpLmZpbmRPbmUobXlxdWVyeSwgZnVuY3Rpb24oZXJyLCByZXN1bHQpIHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgcmVzLnNlbmRTdGF0dXMoNTAwKVxuICAgICAgfSBcbiAgICAgIGVsc2UgaWYgKHJlc3VsdCAhPSBudWxsKSB7XG4gICAgICAgIC8vSWYgd2UgZmluZCBhIHJlc3VsdFxuICAgICAgICBsZXQgbmV3dmFsdWVzID0geyAkc2V0OiB7c3RhdGU6ICEocmVzdWx0LnN0YXRlKX0gfTtcbiAgICAgICAgXG4gICAgICAgIGRiby5jb2xsZWN0aW9uKFwibWVzc2FnZXNcIikudXBkYXRlT25lKG15cXVlcnksIG5ld3ZhbHVlcywgZnVuY3Rpb24oZXJyLCByZXN1bHQyKSB7XG4gICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgZGIuY2xvc2UoKTtcbiAgICAgICAgICAgIHJlcy5zZW5kU3RhdHVzKDUwMClcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBkYi5jbG9zZSgpXG4gICAgICAgICAgICByZXMuc2VuZFN0YXR1cygyMDApXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0gXG4gICAgICBlbHNlIHtcbiAgICAgICAgLy9JZiB3ZSBkb250IGZpbmQgYSByZXN1bHRcbiAgICAgICAgcmVzLnNlbmRTdGF0dXMoNTAwKVxuICAgICAgICBkYi5jbG9zZSgpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIFxuICB9KTtcbn0pXG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vL0dldCBhbGxcbnJvdXRlci5nZXQoKCcvbWVzc2FnZXMnKSwgKHJlcSwgcmVzKSA9PiB7XG5cbiAgTW9uZ29DbGllbnQuY29ubmVjdCh1cmwsIChlcnIsIGRiKSA9PiB7XG4gICAgbGV0IGRibyA9IGRiLmRiKFwidGRwMDEzXCIpO1xuXG4gICAgZGJvLmNvbGxlY3Rpb24oJ21lc3NhZ2VzJykuZmluZCgpLnRvQXJyYXkoZnVuY3Rpb24oZXJyLCByZXN1bHQpIHtcbiAgICAgIGRiLmNsb3NlKCk7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIC8vY29uc29sZS5sb2coZXJyKVxuICAgICAgfVxuICAgICAgZWxzZSBpZiAocmVzdWx0ICE9IG51bGwpIHtcbiAgICAgICAgY29uc29sZS5sb2cocmVzdWx0KVxuICAgICAgICByZXMuc2VuZChyZXN1bHQpXG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgcmVzLnNlbmRTdGF0dXMoNTAwKVxuICAgICAgfVxuICAgIH0pXG4gICAgXG4gIH0pXG59KVxuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gR2V0IG9uZVxucm91dGVyLmdldCgoJy9tZXNzYWdlcy86aWQnKSwgKHJlcSwgcmVzKSA9PiB7XG4gIGxldCBtc2dJZCA9IHNhbml0aXplKHJlcS5wYXJhbXMuaWQpXG4gIGNvbnNvbGUubG9nKFwiSUQ6IFwiICsgbXNnSWQpXG4gIGlmICh0eXBlb2YobXNnSWQpICE9IFwic3RyaW5nXCIpIHtcbiAgICByZXMuc2VuZFN0YXR1cyg0MDApXG4gIH0gZWxzZSB7XG5cbiAgICBNb25nb0NsaWVudC5jb25uZWN0KHVybCwgKGVyciwgZGIpID0+IHtcbiAgICAgIGxldCBkYm8gPSBkYi5kYihcInRkcDAxM1wiKTtcbiAgICAgIGxldCBteXF1ZXJ5ID0geyBpZDogbXNnSWQgfTtcblxuICAgICAgZGJvLmNvbGxlY3Rpb24oXCJtZXNzYWdlc1wiKS5maW5kT25lKG15cXVlcnksIGZ1bmN0aW9uKGVyciwgcmVzdWx0KSB7XG4gICAgICAgIGRiLmNsb3NlKCk7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAvL2NvbnNvbGUubG9nKGVycilcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChyZXN1bHQgIT0gbnVsbCkge1xuICAgICAgICAgIHJlcy5qc29uKHJlc3VsdCkvLy5qc29uKHJlc3VsdClcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICByZXMuc2VuZFN0YXR1cyg1MDApXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG59KVxuXG5hcHAudXNlKGZ1bmN0aW9uIChyZXEsIHJlcykge1xuICAvL2NvbnNvbGUubG9nKFwiZm91bmQgaXRcIilcbiAgcmVzLnNlbmQoXCJTb3JyeSBjYW4ndCBmaW5kIHRoYXQhXCIsIDQwNClcbn0pXG5cblxubW9kdWxlLmV4cG9ydHMgPSByb3V0ZXI7XG5cblxuLyphbnbDpG5kIGFzeW5rcm9uYSBhbnJvcCBmw7ZyIGF0dCBow6RtdGEgb2NoIGxhZ3JhIGRhdGEuIFxuS2FuIHRhIGluIGVuIHJlc29sdmUgb2NoIHJlamVjdCBmdW5rdGlvbi4gXG5NZWQgZGV0dGEga2FuIHZpIHNraWNrYSByw6R0dCBmZWxtZWRkZWxhbmRlbi5cbmVuIGJhY2tlbmQgZmlsIHNvbSBoYW50ZXJhciBsb2dpa1xuZW4gdGVzdGZpbCBzb20gcmVwcmVzZW50ZXJhciBrbGllbnQtbG9naWtlbiBcbihhbGx0c8OlIG9tIHZpIGtsaWNrYXIgcMOlIGVuIGtuYXBwIGtvbW1lciBtZWRkZWxhbmRlIHhcbnNraWNrYXMgdC5leCkqL1xuIl19