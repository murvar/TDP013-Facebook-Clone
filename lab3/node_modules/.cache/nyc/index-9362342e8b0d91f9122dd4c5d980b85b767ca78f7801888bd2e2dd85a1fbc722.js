function cov_23szk0d1c9(){var path="/home/vinah331/Desktop/tdp013/lab3/routes/index.js";var hash="3b80b2564735e51a66aeafbb241e5e2f66aaaed2";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/vinah331/Desktop/tdp013/lab3/routes/index.js",statementMap:{"0":{start:{line:1,column:14},end:{line:1,column:32}},"1":{start:{line:2,column:12},end:{line:2,column:21}},"2":{start:{line:3,column:13},end:{line:3,column:29}},"3":{start:{line:4,column:22},end:{line:4,column:40}},"4":{start:{line:5,column:15},end:{line:5,column:40}},"5":{start:{line:6,column:10},end:{line:6,column:38}},"6":{start:{line:8,column:0},end:{line:8,column:24}},"7":{start:{line:9,column:0},end:{line:9,column:49}},"8":{start:{line:12,column:0},end:{line:26,column:2}},"9":{start:{line:13,column:2},end:{line:13,column:23}},"10":{start:{line:14,column:2},end:{line:25,column:3}},"11":{start:{line:16,column:4},end:{line:19,column:5}},"12":{start:{line:17,column:6},end:{line:17,column:35}},"13":{start:{line:18,column:6},end:{line:18,column:25}},"14":{start:{line:20,column:4},end:{line:20,column:11}},"15":{start:{line:23,column:4},end:{line:23,column:41}},"16":{start:{line:24,column:4},end:{line:24,column:23}},"17":{start:{line:28,column:0},end:{line:35,column:2}},"18":{start:{line:30,column:2},end:{line:34,column:3}},"19":{start:{line:31,column:4},end:{line:31,column:11}},"20":{start:{line:33,column:4},end:{line:33,column:23}},"21":{start:{line:41,column:0},end:{line:66,column:2}},"22":{start:{line:42,column:2},end:{line:42,column:23}},"23":{start:{line:43,column:2},end:{line:64,column:3}},"24":{start:{line:44,column:4},end:{line:44,column:28}},"25":{start:{line:45,column:18},end:{line:45,column:40}},"26":{start:{line:46,column:4},end:{line:61,column:5}},"27":{start:{line:47,column:6},end:{line:57,column:9}},"28":{start:{line:48,column:18},end:{line:48,column:33}},"29":{start:{line:49,column:8},end:{line:56,column:11}},"30":{start:{line:50,column:10},end:{line:54,column:11}},"31":{start:{line:52,column:12},end:{line:52,column:23}},"32":{start:{line:53,column:12},end:{line:53,column:31}},"33":{start:{line:60,column:6},end:{line:60,column:25}},"34":{start:{line:63,column:4},end:{line:63,column:23}},"35":{start:{line:70,column:2},end:{line:70,column:70}},"36":{start:{line:70,column:56},end:{line:70,column:68}},"37":{start:{line:71,column:2},end:{line:71,column:77}},"38":{start:{line:71,column:63},end:{line:71,column:75}},"39":{start:{line:72,column:2},end:{line:72,column:72}},"40":{start:{line:72,column:58},end:{line:72,column:70}},"41":{start:{line:73,column:2},end:{line:73,column:13}},"42":{start:{line:78,column:0},end:{line:119,column:2}},"43":{start:{line:79,column:2},end:{line:79,column:21}},"44":{start:{line:80,column:14},end:{line:80,column:37}},"45":{start:{line:83,column:2},end:{line:118,column:3}},"46":{start:{line:84,column:4},end:{line:84,column:23}},"47":{start:{line:87,column:4},end:{line:117,column:7}},"48":{start:{line:88,column:16},end:{line:88,column:31}},"49":{start:{line:89,column:20},end:{line:89,column:33}},"50":{start:{line:91,column:6},end:{line:115,column:9}},"51":{start:{line:92,column:8},end:{line:114,column:9}},"52":{start:{line:93,column:10},end:{line:93,column:29}},"53":{start:{line:95,column:13},end:{line:114,column:9}},"54":{start:{line:97,column:26},end:{line:97,column:60}},"55":{start:{line:99,column:10},end:{line:108,column:13}},"56":{start:{line:100,column:12},end:{line:107,column:13}},"57":{start:{line:101,column:14},end:{line:101,column:25}},"58":{start:{line:102,column:14},end:{line:102,column:33}},"59":{start:{line:105,column:14},end:{line:105,column:24}},"60":{start:{line:106,column:14},end:{line:106,column:33}},"61":{start:{line:112,column:10},end:{line:112,column:29}},"62":{start:{line:113,column:10},end:{line:113,column:21}},"63":{start:{line:123,column:0},end:{line:143,column:2}},"64":{start:{line:125,column:2},end:{line:142,column:4}},"65":{start:{line:126,column:14},end:{line:126,column:29}},"66":{start:{line:128,column:4},end:{line:140,column:6}},"67":{start:{line:129,column:6},end:{line:129,column:17}},"68":{start:{line:130,column:6},end:{line:139,column:7}},"69":{start:{line:133,column:11},end:{line:139,column:7}},"70":{start:{line:134,column:8},end:{line:134,column:27}},"71":{start:{line:135,column:8},end:{line:135,column:24}},"72":{start:{line:138,column:8},end:{line:138,column:27}},"73":{start:{line:147,column:0},end:{line:172,column:2}},"74":{start:{line:148,column:14},end:{line:148,column:37}},"75":{start:{line:149,column:2},end:{line:149,column:29}},"76":{start:{line:150,column:2},end:{line:171,column:3}},"77":{start:{line:151,column:4},end:{line:151,column:23}},"78":{start:{line:154,column:4},end:{line:170,column:7}},"79":{start:{line:155,column:16},end:{line:155,column:31}},"80":{start:{line:156,column:20},end:{line:156,column:33}},"81":{start:{line:158,column:6},end:{line:169,column:9}},"82":{start:{line:159,column:8},end:{line:159,column:19}},"83":{start:{line:160,column:8},end:{line:168,column:9}},"84":{start:{line:163,column:13},end:{line:168,column:9}},"85":{start:{line:164,column:10},end:{line:164,column:26}},"86":{start:{line:167,column:10},end:{line:167,column:29}},"87":{start:{line:174,column:0},end:{line:177,column:2}},"88":{start:{line:176,column:2},end:{line:176,column:41}},"89":{start:{line:180,column:0},end:{line:180,column:24}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:12,column:24},end:{line:12,column:25}},loc:{start:{line:12,column:49},end:{line:26,column:1}},line:12},"1":{name:"(anonymous_1)",decl:{start:{line:28,column:28},end:{line:28,column:29}},loc:{start:{line:28,column:53},end:{line:35,column:1}},line:28},"2":{name:"(anonymous_2)",decl:{start:{line:41,column:25},end:{line:41,column:26}},loc:{start:{line:41,column:39},end:{line:66,column:1}},line:41},"3":{name:"(anonymous_3)",decl:{start:{line:47,column:31},end:{line:47,column:32}},loc:{start:{line:47,column:44},end:{line:57,column:7}},line:47},"4":{name:"(anonymous_4)",decl:{start:{line:49,column:50},end:{line:49,column:51}},loc:{start:{line:49,column:72},end:{line:56,column:9}},line:49},"5":{name:"validateMsg",decl:{start:{line:68,column:9},end:{line:68,column:20}},loc:{start:{line:68,column:27},end:{line:74,column:1}},line:68},"6":{name:"(anonymous_6)",decl:{start:{line:78,column:32},end:{line:78,column:33}},loc:{start:{line:78,column:46},end:{line:119,column:1}},line:78},"7":{name:"(anonymous_7)",decl:{start:{line:87,column:29},end:{line:87,column:30}},loc:{start:{line:87,column:42},end:{line:117,column:5}},line:87},"8":{name:"(anonymous_8)",decl:{start:{line:91,column:50},end:{line:91,column:51}},loc:{start:{line:91,column:72},end:{line:115,column:7}},line:91},"9":{name:"(anonymous_9)",decl:{start:{line:99,column:67},end:{line:99,column:68}},loc:{start:{line:99,column:90},end:{line:108,column:11}},line:99},"10":{name:"(anonymous_10)",decl:{start:{line:123,column:26},end:{line:123,column:27}},loc:{start:{line:123,column:40},end:{line:143,column:1}},line:123},"11":{name:"(anonymous_11)",decl:{start:{line:125,column:27},end:{line:125,column:28}},loc:{start:{line:125,column:40},end:{line:142,column:3}},line:125},"12":{name:"(anonymous_12)",decl:{start:{line:128,column:46},end:{line:128,column:47}},loc:{start:{line:128,column:68},end:{line:140,column:5}},line:128},"13":{name:"(anonymous_13)",decl:{start:{line:147,column:30},end:{line:147,column:31}},loc:{start:{line:147,column:44},end:{line:172,column:1}},line:147},"14":{name:"(anonymous_14)",decl:{start:{line:154,column:29},end:{line:154,column:30}},loc:{start:{line:154,column:42},end:{line:170,column:5}},line:154},"15":{name:"(anonymous_15)",decl:{start:{line:158,column:50},end:{line:158,column:51}},loc:{start:{line:158,column:72},end:{line:169,column:7}},line:158},"16":{name:"(anonymous_16)",decl:{start:{line:174,column:8},end:{line:174,column:9}},loc:{start:{line:174,column:28},end:{line:177,column:1}},line:174}},branchMap:{"0":{loc:{start:{line:14,column:2},end:{line:25,column:3}},type:"if",locations:[{start:{line:14,column:2},end:{line:25,column:3}},{start:{line:14,column:2},end:{line:25,column:3}}],line:14},"1":{loc:{start:{line:14,column:5},end:{line:14,column:48}},type:"binary-expr",locations:[{start:{line:14,column:5},end:{line:14,column:25}},{start:{line:14,column:29},end:{line:14,column:48}}],line:14},"2":{loc:{start:{line:16,column:4},end:{line:19,column:5}},type:"if",locations:[{start:{line:16,column:4},end:{line:19,column:5}},{start:{line:16,column:4},end:{line:19,column:5}}],line:16},"3":{loc:{start:{line:16,column:8},end:{line:16,column:45}},type:"binary-expr",locations:[{start:{line:16,column:8},end:{line:16,column:27}},{start:{line:16,column:31},end:{line:16,column:45}}],line:16},"4":{loc:{start:{line:30,column:2},end:{line:34,column:3}},type:"if",locations:[{start:{line:30,column:2},end:{line:34,column:3}},{start:{line:30,column:2},end:{line:34,column:3}}],line:30},"5":{loc:{start:{line:30,column:5},end:{line:30,column:49}},type:"binary-expr",locations:[{start:{line:30,column:5},end:{line:30,column:26}},{start:{line:30,column:30},end:{line:30,column:49}}],line:30},"6":{loc:{start:{line:43,column:2},end:{line:64,column:3}},type:"if",locations:[{start:{line:43,column:2},end:{line:64,column:3}},{start:{line:43,column:2},end:{line:64,column:3}}],line:43},"7":{loc:{start:{line:46,column:4},end:{line:61,column:5}},type:"if",locations:[{start:{line:46,column:4},end:{line:61,column:5}},{start:{line:46,column:4},end:{line:61,column:5}}],line:46},"8":{loc:{start:{line:50,column:10},end:{line:54,column:11}},type:"if",locations:[{start:{line:50,column:10},end:{line:54,column:11}},{start:{line:50,column:10},end:{line:54,column:11}}],line:50},"9":{loc:{start:{line:70,column:2},end:{line:70,column:70}},type:"if",locations:[{start:{line:70,column:2},end:{line:70,column:70}},{start:{line:70,column:2},end:{line:70,column:70}}],line:70},"10":{loc:{start:{line:70,column:6},end:{line:70,column:52}},type:"binary-expr",locations:[{start:{line:70,column:6},end:{line:70,column:27}},{start:{line:70,column:31},end:{line:70,column:52}}],line:70},"11":{loc:{start:{line:71,column:2},end:{line:71,column:77}},type:"if",locations:[{start:{line:71,column:2},end:{line:71,column:77}},{start:{line:71,column:2},end:{line:71,column:77}}],line:71},"12":{loc:{start:{line:72,column:2},end:{line:72,column:72}},type:"if",locations:[{start:{line:72,column:2},end:{line:72,column:72}},{start:{line:72,column:2},end:{line:72,column:72}}],line:72},"13":{loc:{start:{line:83,column:2},end:{line:118,column:3}},type:"if",locations:[{start:{line:83,column:2},end:{line:118,column:3}},{start:{line:83,column:2},end:{line:118,column:3}}],line:83},"14":{loc:{start:{line:92,column:8},end:{line:114,column:9}},type:"if",locations:[{start:{line:92,column:8},end:{line:114,column:9}},{start:{line:92,column:8},end:{line:114,column:9}}],line:92},"15":{loc:{start:{line:95,column:13},end:{line:114,column:9}},type:"if",locations:[{start:{line:95,column:13},end:{line:114,column:9}},{start:{line:95,column:13},end:{line:114,column:9}}],line:95},"16":{loc:{start:{line:100,column:12},end:{line:107,column:13}},type:"if",locations:[{start:{line:100,column:12},end:{line:107,column:13}},{start:{line:100,column:12},end:{line:107,column:13}}],line:100},"17":{loc:{start:{line:130,column:6},end:{line:139,column:7}},type:"if",locations:[{start:{line:130,column:6},end:{line:139,column:7}},{start:{line:130,column:6},end:{line:139,column:7}}],line:130},"18":{loc:{start:{line:133,column:11},end:{line:139,column:7}},type:"if",locations:[{start:{line:133,column:11},end:{line:139,column:7}},{start:{line:133,column:11},end:{line:139,column:7}}],line:133},"19":{loc:{start:{line:150,column:2},end:{line:171,column:3}},type:"if",locations:[{start:{line:150,column:2},end:{line:171,column:3}},{start:{line:150,column:2},end:{line:171,column:3}}],line:150},"20":{loc:{start:{line:160,column:8},end:{line:168,column:9}},type:"if",locations:[{start:{line:160,column:8},end:{line:168,column:9}},{start:{line:160,column:8},end:{line:168,column:9}}],line:160},"21":{loc:{start:{line:163,column:13},end:{line:168,column:9}},type:"if",locations:[{start:{line:163,column:13},end:{line:168,column:9}},{start:{line:163,column:13},end:{line:168,column:9}}],line:163}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"3b80b2564735e51a66aeafbb241e5e2f66aaaed2"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_23szk0d1c9=function(){return actualCoverage;};}return actualCoverage;}cov_23szk0d1c9();var express=(cov_23szk0d1c9().s[0]++,require('express'));const app=(cov_23szk0d1c9().s[1]++,express());var router=(cov_23szk0d1c9().s[2]++,express.Router());const{MongoClient}=(cov_23szk0d1c9().s[3]++,require('mongodb'));let sanitize=(cov_23szk0d1c9().s[4]++,require('mongo-sanitize'));let url=(cov_23szk0d1c9().s[5]++,"mongodb://localhost:27017/");cov_23szk0d1c9().s[6]++;app.use(express.json());cov_23szk0d1c9().s[7]++;app.use(express.urlencoded({extended:false}));cov_23szk0d1c9().s[8]++;router.all('/messages',function(req,res,next){cov_23szk0d1c9().f[0]++;cov_23szk0d1c9().s[9]++;console.log(req.body);cov_23szk0d1c9().s[10]++;if((cov_23szk0d1c9().b[1][0]++,req.method=="POST")||(cov_23szk0d1c9().b[1][1]++,req.method=="GET")){cov_23szk0d1c9().b[0][0]++;cov_23szk0d1c9().s[11]++;//Kolla om get har en body?
if((cov_23szk0d1c9().b[3][0]++,req.method=="GET")&&(cov_23szk0d1c9().b[3][1]++,req.body=={})){cov_23szk0d1c9().b[2][0]++;cov_23szk0d1c9().s[12]++;//Hur funkar det här???
console.log("failed get all");cov_23szk0d1c9().s[13]++;res.sendStatus(405);}else{cov_23szk0d1c9().b[2][1]++;}cov_23szk0d1c9().s[14]++;next();}else{cov_23szk0d1c9().b[0][1]++;cov_23szk0d1c9().s[15]++;//console.log(req.method)
console.log("another failed get all");cov_23szk0d1c9().s[16]++;res.sendStatus(405);}});cov_23szk0d1c9().s[17]++;router.all('/messages/:id',function(req,res,next){cov_23szk0d1c9().f[1]++;cov_23szk0d1c9().s[18]++;//console.log("1")
if((cov_23szk0d1c9().b[5][0]++,req.method=="PATCH")||(cov_23szk0d1c9().b[5][1]++,req.method=="GET")){cov_23szk0d1c9().b[4][0]++;cov_23szk0d1c9().s[19]++;next();}else{cov_23szk0d1c9().b[4][1]++;cov_23szk0d1c9().s[20]++;res.sendStatus(405);}});//------------------------------------------------------------------
//Save one
cov_23szk0d1c9().s[21]++;router.post('/messages',(req,res)=>{cov_23szk0d1c9().f[2]++;cov_23szk0d1c9().s[22]++;console.log(req.body);cov_23szk0d1c9().s[23]++;if(validateMsg(req.body)){cov_23szk0d1c9().b[6][0]++;cov_23szk0d1c9().s[24]++;msg=sanitize(req.body);const regex=(cov_23szk0d1c9().s[25]++,new RegExp(/<script>/));//injection?
cov_23szk0d1c9().s[26]++;if(!regex.test(msg)){cov_23szk0d1c9().b[7][0]++;cov_23szk0d1c9().s[27]++;MongoClient.connect(url,(err,db)=>{cov_23szk0d1c9().f[3]++;let dbo=(cov_23szk0d1c9().s[28]++,db.db("tdp013"));cov_23szk0d1c9().s[29]++;dbo.collection('messages').insertOne(msg,function(err,result){cov_23szk0d1c9().f[4]++;cov_23szk0d1c9().s[30]++;if(err){cov_23szk0d1c9().b[8][0]++;}else{cov_23szk0d1c9().b[8][1]++;cov_23szk0d1c9().s[31]++;db.close();cov_23szk0d1c9().s[32]++;res.sendStatus(200);}});});}else{cov_23szk0d1c9().b[7][1]++;cov_23szk0d1c9().s[33]++;res.sendStatus(500);}}else{cov_23szk0d1c9().b[6][1]++;cov_23szk0d1c9().s[34]++;res.sendStatus(500);}});function validateMsg(body){cov_23szk0d1c9().f[5]++;cov_23szk0d1c9().s[35]++;if((cov_23szk0d1c9().b[10][0]++,body.msg.length===0)||(cov_23szk0d1c9().b[10][1]++,body.msg.length>140)){cov_23szk0d1c9().b[9][0]++;cov_23szk0d1c9().s[36]++;return false;}else{cov_23szk0d1c9().b[9][1]++;}cov_23szk0d1c9().s[37]++;if(!(typeof body.id=="string")){cov_23szk0d1c9().b[11][0]++;cov_23szk0d1c9().s[38]++;return false;}else{cov_23szk0d1c9().b[11][1]++;}cov_23szk0d1c9().s[39]++;if(typeof body.state!=="boolean"){cov_23szk0d1c9().b[12][0]++;cov_23szk0d1c9().s[40]++;return false;}else{cov_23szk0d1c9().b[12][1]++;}cov_23szk0d1c9().s[41]++;return true;}//------------------------------------------------------------------
//Mark read
cov_23szk0d1c9().s[42]++;router.patch('/messages/:id',(req,res)=>{cov_23szk0d1c9().f[6]++;cov_23szk0d1c9().s[43]++;console.log("HERE");let msgId=(cov_23szk0d1c9().s[44]++,sanitize(req.params.id));//console.log("in patch function with value " + msgId)
cov_23szk0d1c9().s[45]++;if(typeof msgId!="string"){cov_23szk0d1c9().b[13][0]++;cov_23szk0d1c9().s[46]++;res.sendStatus(400);}else{cov_23szk0d1c9().b[13][1]++;cov_23szk0d1c9().s[47]++;MongoClient.connect(url,(err,db)=>{cov_23szk0d1c9().f[7]++;let dbo=(cov_23szk0d1c9().s[48]++,db.db("tdp013"));let myquery=(cov_23szk0d1c9().s[49]++,{id:msgId});cov_23szk0d1c9().s[50]++;dbo.collection("messages").findOne(myquery,function(err,result){cov_23szk0d1c9().f[8]++;cov_23szk0d1c9().s[51]++;if(err){cov_23szk0d1c9().b[14][0]++;cov_23szk0d1c9().s[52]++;res.sendStatus(500);}else{cov_23szk0d1c9().b[14][1]++;cov_23szk0d1c9().s[53]++;if(result!=null){cov_23szk0d1c9().b[15][0]++;//If we find a result
let newvalues=(cov_23szk0d1c9().s[54]++,{$set:{state:!result.state}});cov_23szk0d1c9().s[55]++;dbo.collection("messages").updateOne(myquery,newvalues,function(err,result2){cov_23szk0d1c9().f[9]++;cov_23szk0d1c9().s[56]++;if(err){cov_23szk0d1c9().b[16][0]++;cov_23szk0d1c9().s[57]++;db.close();cov_23szk0d1c9().s[58]++;res.sendStatus(500);}else{cov_23szk0d1c9().b[16][1]++;cov_23szk0d1c9().s[59]++;db.close();cov_23szk0d1c9().s[60]++;res.sendStatus(200);}});}else{cov_23szk0d1c9().b[15][1]++;cov_23szk0d1c9().s[61]++;//If we dont find a result
res.sendStatus(500);cov_23szk0d1c9().s[62]++;db.close();}}});});}});//------------------------------------------------------------------
//Get all
cov_23szk0d1c9().s[63]++;router.get('/messages',(req,res)=>{cov_23szk0d1c9().f[10]++;cov_23szk0d1c9().s[64]++;MongoClient.connect(url,(err,db)=>{cov_23szk0d1c9().f[11]++;let dbo=(cov_23szk0d1c9().s[65]++,db.db("tdp013"));cov_23szk0d1c9().s[66]++;dbo.collection('messages').find().toArray(function(err,result){cov_23szk0d1c9().f[12]++;cov_23szk0d1c9().s[67]++;db.close();cov_23szk0d1c9().s[68]++;if(err){//console.log(err)
cov_23szk0d1c9().b[17][0]++;}else{cov_23szk0d1c9().b[17][1]++;cov_23szk0d1c9().s[69]++;if(result!=null){cov_23szk0d1c9().b[18][0]++;cov_23szk0d1c9().s[70]++;console.log(result);cov_23szk0d1c9().s[71]++;res.send(result);}else{cov_23szk0d1c9().b[18][1]++;cov_23szk0d1c9().s[72]++;res.sendStatus(500);}}});});});//------------------------------------------------------------------
// Get one
cov_23szk0d1c9().s[73]++;router.get('/messages/:id',(req,res)=>{cov_23szk0d1c9().f[13]++;let msgId=(cov_23szk0d1c9().s[74]++,sanitize(req.params.id));cov_23szk0d1c9().s[75]++;console.log("ID: "+msgId);cov_23szk0d1c9().s[76]++;if(typeof msgId!="string"){cov_23szk0d1c9().b[19][0]++;cov_23szk0d1c9().s[77]++;res.sendStatus(400);}else{cov_23szk0d1c9().b[19][1]++;cov_23szk0d1c9().s[78]++;MongoClient.connect(url,(err,db)=>{cov_23szk0d1c9().f[14]++;let dbo=(cov_23szk0d1c9().s[79]++,db.db("tdp013"));let myquery=(cov_23szk0d1c9().s[80]++,{id:msgId});cov_23szk0d1c9().s[81]++;dbo.collection("messages").findOne(myquery,function(err,result){cov_23szk0d1c9().f[15]++;cov_23szk0d1c9().s[82]++;db.close();cov_23szk0d1c9().s[83]++;if(err){//console.log(err)
cov_23szk0d1c9().b[20][0]++;}else{cov_23szk0d1c9().b[20][1]++;cov_23szk0d1c9().s[84]++;if(result!=null){cov_23szk0d1c9().b[21][0]++;cov_23szk0d1c9().s[85]++;res.json(result);//.json(result)
}else{cov_23szk0d1c9().b[21][1]++;cov_23szk0d1c9().s[86]++;res.sendStatus(500);}}});});}});cov_23szk0d1c9().s[87]++;app.use(function(req,res){cov_23szk0d1c9().f[16]++;cov_23szk0d1c9().s[88]++;//console.log("found it")
res.send("Sorry can't find that!",404);});cov_23szk0d1c9().s[89]++;module.exports=router;/*använd asynkrona anrop för att hämta och lagra data. 
Kan ta in en resolve och reject funktion. 
Med detta kan vi skicka rätt felmeddelanden.
en backend fil som hanterar logik
en testfil som representerar klient-logiken 
(alltså om vi klickar på en knapp kommer meddelande x
skickas t.ex)*/
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImV4cHJlc3MiLCJyZXF1aXJlIiwiYXBwIiwicm91dGVyIiwiUm91dGVyIiwiTW9uZ29DbGllbnQiLCJzYW5pdGl6ZSIsInVybCIsInVzZSIsImpzb24iLCJ1cmxlbmNvZGVkIiwiZXh0ZW5kZWQiLCJhbGwiLCJyZXEiLCJyZXMiLCJuZXh0IiwiY29uc29sZSIsImxvZyIsImJvZHkiLCJtZXRob2QiLCJzZW5kU3RhdHVzIiwicG9zdCIsInZhbGlkYXRlTXNnIiwibXNnIiwicmVnZXgiLCJSZWdFeHAiLCJ0ZXN0IiwiY29ubmVjdCIsImVyciIsImRiIiwiZGJvIiwiY29sbGVjdGlvbiIsImluc2VydE9uZSIsInJlc3VsdCIsImNsb3NlIiwibGVuZ3RoIiwiaWQiLCJzdGF0ZSIsInBhdGNoIiwibXNnSWQiLCJwYXJhbXMiLCJteXF1ZXJ5IiwiZmluZE9uZSIsIm5ld3ZhbHVlcyIsIiRzZXQiLCJ1cGRhdGVPbmUiLCJyZXN1bHQyIiwiZ2V0IiwiZmluZCIsInRvQXJyYXkiLCJzZW5kIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Imt0YUFlWTsyRkFmWixHQUFJQSxDQUFBQSxPQUFPLDBCQUFHQyxPQUFPLENBQUMsU0FBRCxDQUFWLENBQVgsQ0FDQSxLQUFNQyxDQUFBQSxHQUFHLDBCQUFHRixPQUFPLEVBQVYsQ0FBVCxDQUNBLEdBQUlHLENBQUFBLE1BQU0sMEJBQUdILE9BQU8sQ0FBQ0ksTUFBUixFQUFILENBQVYsQ0FDQSxLQUFNLENBQUNDLFdBQUQsMkJBQWdCSixPQUFPLENBQUMsU0FBRCxDQUF2QixDQUFOLENBQ0EsR0FBSUssQ0FBQUEsUUFBUSwwQkFBR0wsT0FBTyxDQUFDLGdCQUFELENBQVYsQ0FBWixDQUNBLEdBQUlNLENBQUFBLEdBQUcsMEJBQUcsNEJBQUgsQ0FBUCxDLHdCQUVBTCxHQUFHLENBQUNNLEdBQUosQ0FBUVIsT0FBTyxDQUFDUyxJQUFSLEVBQVIsRSx3QkFDQVAsR0FBRyxDQUFDTSxHQUFKLENBQVFSLE9BQU8sQ0FBQ1UsVUFBUixDQUFtQixDQUFFQyxRQUFRLENBQUUsS0FBWixDQUFuQixDQUFSLEUsd0JBR0FSLE1BQU0sQ0FBQ1MsR0FBUCxDQUFXLFdBQVgsQ0FBd0IsU0FBU0MsR0FBVCxDQUFjQyxHQUFkLENBQW1CQyxJQUFuQixDQUF5QixpREFDL0NDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZSixHQUFHLENBQUNLLElBQWhCLEVBRCtDLHlCQUUvQyxHQUFHLDRCQUFBTCxHQUFHLENBQUNNLE1BQUosRUFBYyxNQUFkLCtCQUF3Qk4sR0FBRyxDQUFDTSxNQUFKLEVBQWMsS0FBdEMsQ0FBSCxDQUFnRCxxREFDOUM7QUFDQSxHQUFJLDRCQUFBTixHQUFHLENBQUNNLE1BQUosRUFBYyxLQUFkLCtCQUF1Qk4sR0FBRyxDQUFDSyxJQUFKLEVBQVksRUFBbkMsQ0FBSixDQUEyQyxxREFBRTtBQUMzQ0YsT0FBTyxDQUFDQyxHQUFSLENBQVksZ0JBQVosRUFEeUMseUJBRXpDSCxHQUFHLENBQUNNLFVBQUosQ0FBZSxHQUFmLEVBQ0QsQ0FIRCxpQ0FGOEMseUJBTTlDTCxJQUFJLEdBQ0wsQ0FQRCxJQU9PLHFEQUNMO0FBQ0FDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLHdCQUFaLEVBRksseUJBR0xILEdBQUcsQ0FBQ00sVUFBSixDQUFlLEdBQWYsRUFDRCxDQUNGLENBZEQsRSx5QkFnQkFqQixNQUFNLENBQUNTLEdBQVAsQ0FBVyxlQUFYLENBQTRCLFNBQVNDLEdBQVQsQ0FBY0MsR0FBZCxDQUFtQkMsSUFBbkIsQ0FBeUIsa0RBQ25EO0FBQ0EsR0FBRyw0QkFBQUYsR0FBRyxDQUFDTSxNQUFKLEVBQWMsT0FBZCwrQkFBeUJOLEdBQUcsQ0FBQ00sTUFBSixFQUFjLEtBQXZDLENBQUgsQ0FBaUQscURBQy9DSixJQUFJLEdBQ0wsQ0FGRCxJQUVPLHFEQUNMRCxHQUFHLENBQUNNLFVBQUosQ0FBZSxHQUFmLEVBQ0QsQ0FDRixDQVBELEVBVUE7QUFDQTt5QkFFQWpCLE1BQU0sQ0FBQ2tCLElBQVAsQ0FBWSxXQUFaLENBQXlCLENBQUNSLEdBQUQsQ0FBTUMsR0FBTixHQUFjLGtEQUNyQ0UsT0FBTyxDQUFDQyxHQUFSLENBQVlKLEdBQUcsQ0FBQ0ssSUFBaEIsRUFEcUMseUJBRXJDLEdBQUlJLFdBQVcsQ0FBQ1QsR0FBRyxDQUFDSyxJQUFMLENBQWYsQ0FBMkIscURBQ3pCSyxHQUFHLENBQUdqQixRQUFRLENBQUNPLEdBQUcsQ0FBQ0ssSUFBTCxDQUFkLENBQ0EsS0FBTU0sQ0FBQUEsS0FBSywyQkFBRyxHQUFJQyxDQUFBQSxNQUFKLENBQVcsVUFBWCxDQUFILENBQVgsQ0FBc0M7QUFGYix5QkFHekIsR0FBSSxDQUFDRCxLQUFLLENBQUNFLElBQU4sQ0FBV0gsR0FBWCxDQUFMLENBQXNCLHFEQUNwQmxCLFdBQVcsQ0FBQ3NCLE9BQVosQ0FBb0JwQixHQUFwQixDQUF5QixDQUFDcUIsR0FBRCxDQUFNQyxFQUFOLEdBQWEseUJBQ3BDLEdBQUlDLENBQUFBLEdBQUcsMkJBQUdELEVBQUUsQ0FBQ0EsRUFBSCxDQUFNLFFBQU4sQ0FBSCxDQUFQLENBRG9DLHlCQUVwQ0MsR0FBRyxDQUFDQyxVQUFKLENBQWUsVUFBZixFQUEyQkMsU0FBM0IsQ0FBcUNULEdBQXJDLENBQTBDLFNBQVNLLEdBQVQsQ0FBY0ssTUFBZCxDQUFzQixrREFDOUQsR0FBSUwsR0FBSixDQUFTLDRCQUFFLENBQVgsSUFDSyxxREFDSEMsRUFBRSxDQUFDSyxLQUFILEdBREcseUJBRUhwQixHQUFHLENBQUNNLFVBQUosQ0FBZSxHQUFmLEVBQ0QsQ0FFRixDQVBELEVBUUQsQ0FWRCxFQVdELENBWkQsSUFhSyxxREFDSE4sR0FBRyxDQUFDTSxVQUFKLENBQWUsR0FBZixFQUNELENBQ0YsQ0FuQkQsSUFtQk8scURBQ0xOLEdBQUcsQ0FBQ00sVUFBSixDQUFlLEdBQWYsRUFDRCxDQUVGLENBekJELEVBMkJBLFFBQVNFLENBQUFBLFdBQVQsQ0FBcUJKLElBQXJCLENBQTJCLGtEQUV6QixHQUFJLDZCQUFBQSxJQUFJLENBQUNLLEdBQUwsQ0FBU1ksTUFBVCxHQUFvQixDQUFwQixnQ0FBeUJqQixJQUFJLENBQUNLLEdBQUwsQ0FBU1ksTUFBVCxDQUFrQixHQUEzQyxDQUFKLENBQW9ELHFEQUFFLE1BQU8sTUFBUCxDQUFjLENBQXBFLGlDQUZ5Qix5QkFHekIsR0FBSSxFQUFFLE1BQU9qQixDQUFBQSxJQUFJLENBQUNrQixFQUFaLEVBQW1CLFFBQXJCLENBQUosQ0FBMkQsc0RBQUUsTUFBTyxNQUFQLENBQWMsQ0FBM0Usa0NBSHlCLHlCQUl6QixHQUFJLE1BQU9sQixDQUFBQSxJQUFJLENBQUNtQixLQUFaLEdBQXVCLFNBQTNCLENBQXNELHNEQUFFLE1BQU8sTUFBUCxDQUFjLENBQXRFLGtDQUp5Qix5QkFLekIsTUFBTyxLQUFQLENBQ0QsQ0FFRDtBQUNBO3lCQUNBbEMsTUFBTSxDQUFDbUMsS0FBUCxDQUFjLGVBQWQsQ0FBZ0MsQ0FBQ3pCLEdBQUQsQ0FBTUMsR0FBTixHQUFjLGtEQUM1Q0UsT0FBTyxDQUFDQyxHQUFSLENBQVksTUFBWixFQUNBLEdBQUlzQixDQUFBQSxLQUFLLDJCQUFHakMsUUFBUSxDQUFDTyxHQUFHLENBQUMyQixNQUFKLENBQVdKLEVBQVosQ0FBWCxDQUFULENBQ0E7QUFINEMseUJBSzVDLEdBQUksTUFBT0csQ0FBQUEsS0FBUCxFQUFpQixRQUFyQixDQUErQixzREFDN0J6QixHQUFHLENBQUNNLFVBQUosQ0FBZSxHQUFmLEVBRUQsQ0FIRCxJQUdPLHNEQUNMZixXQUFXLENBQUNzQixPQUFaLENBQW9CcEIsR0FBcEIsQ0FBeUIsQ0FBQ3FCLEdBQUQsQ0FBTUMsRUFBTixHQUFhLHlCQUNwQyxHQUFJQyxDQUFBQSxHQUFHLDJCQUFHRCxFQUFFLENBQUNBLEVBQUgsQ0FBTSxRQUFOLENBQUgsQ0FBUCxDQUNBLEdBQUlZLENBQUFBLE9BQU8sMkJBQUcsQ0FBRUwsRUFBRSxDQUFFRyxLQUFOLENBQUgsQ0FBWCxDQUZvQyx5QkFJcENULEdBQUcsQ0FBQ0MsVUFBSixDQUFlLFVBQWYsRUFBMkJXLE9BQTNCLENBQW1DRCxPQUFuQyxDQUE0QyxTQUFTYixHQUFULENBQWNLLE1BQWQsQ0FBc0Isa0RBQ2hFLEdBQUlMLEdBQUosQ0FBUyxzREFDUGQsR0FBRyxDQUFDTSxVQUFKLENBQWUsR0FBZixFQUNELENBRkQsSUFHSyx5REFBSWEsTUFBTSxFQUFJLElBQWQsQ0FBb0IsNkJBQ3ZCO0FBQ0EsR0FBSVUsQ0FBQUEsU0FBUywyQkFBRyxDQUFFQyxJQUFJLENBQUUsQ0FBQ1AsS0FBSyxDQUFFLENBQUVKLE1BQU0sQ0FBQ0ksS0FBakIsQ0FBUixDQUFILENBQWIsQ0FGdUIseUJBSXZCUCxHQUFHLENBQUNDLFVBQUosQ0FBZSxVQUFmLEVBQTJCYyxTQUEzQixDQUFxQ0osT0FBckMsQ0FBOENFLFNBQTlDLENBQXlELFNBQVNmLEdBQVQsQ0FBY2tCLE9BQWQsQ0FBdUIsa0RBQzlFLEdBQUlsQixHQUFKLENBQVMsc0RBQ1BDLEVBQUUsQ0FBQ0ssS0FBSCxHQURPLHlCQUVQcEIsR0FBRyxDQUFDTSxVQUFKLENBQWUsR0FBZixFQUNELENBSEQsSUFJSyxzREFDSFMsRUFBRSxDQUFDSyxLQUFILEdBREcseUJBRUhwQixHQUFHLENBQUNNLFVBQUosQ0FBZSxHQUFmLEVBQ0QsQ0FDRixDQVRELEVBVUQsQ0FkSSxJQWVBLHNEQUNIO0FBQ0FOLEdBQUcsQ0FBQ00sVUFBSixDQUFlLEdBQWYsRUFGRyx5QkFHSFMsRUFBRSxDQUFDSyxLQUFILEdBQ0QsRUFDRixDQXhCRCxFQTBCRCxDQTlCRCxFQStCRCxDQUNGLENBekNELEVBMkNBO0FBQ0E7eUJBQ0EvQixNQUFNLENBQUM0QyxHQUFQLENBQVksV0FBWixDQUEwQixDQUFDbEMsR0FBRCxDQUFNQyxHQUFOLEdBQWMsbURBRXRDVCxXQUFXLENBQUNzQixPQUFaLENBQW9CcEIsR0FBcEIsQ0FBeUIsQ0FBQ3FCLEdBQUQsQ0FBTUMsRUFBTixHQUFhLDBCQUNwQyxHQUFJQyxDQUFBQSxHQUFHLDJCQUFHRCxFQUFFLENBQUNBLEVBQUgsQ0FBTSxRQUFOLENBQUgsQ0FBUCxDQURvQyx5QkFHcENDLEdBQUcsQ0FBQ0MsVUFBSixDQUFlLFVBQWYsRUFBMkJpQixJQUEzQixHQUFrQ0MsT0FBbEMsQ0FBMEMsU0FBU3JCLEdBQVQsQ0FBY0ssTUFBZCxDQUFzQixtREFDOURKLEVBQUUsQ0FBQ0ssS0FBSCxHQUQ4RCx5QkFFOUQsR0FBSU4sR0FBSixDQUFTLENBQ1A7QUFETyw0QkFFUixDQUZELElBR0sseURBQUlLLE1BQU0sRUFBSSxJQUFkLENBQW9CLHNEQUN2QmpCLE9BQU8sQ0FBQ0MsR0FBUixDQUFZZ0IsTUFBWixFQUR1Qix5QkFFdkJuQixHQUFHLENBQUNvQyxJQUFKLENBQVNqQixNQUFULEVBQ0QsQ0FISSxJQUlBLHNEQUNIbkIsR0FBRyxDQUFDTSxVQUFKLENBQWUsR0FBZixFQUNELEVBQ0YsQ0FaRCxFQWNELENBakJELEVBa0JELENBcEJELEVBc0JBO0FBQ0E7eUJBQ0FqQixNQUFNLENBQUM0QyxHQUFQLENBQVksZUFBWixDQUE4QixDQUFDbEMsR0FBRCxDQUFNQyxHQUFOLEdBQWMsMEJBQzFDLEdBQUl5QixDQUFBQSxLQUFLLDJCQUFHakMsUUFBUSxDQUFDTyxHQUFHLENBQUMyQixNQUFKLENBQVdKLEVBQVosQ0FBWCxDQUFULENBRDBDLHlCQUUxQ3BCLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLE9BQVNzQixLQUFyQixFQUYwQyx5QkFHMUMsR0FBSSxNQUFPQSxDQUFBQSxLQUFQLEVBQWlCLFFBQXJCLENBQStCLHNEQUM3QnpCLEdBQUcsQ0FBQ00sVUFBSixDQUFlLEdBQWYsRUFDRCxDQUZELElBRU8sc0RBRUxmLFdBQVcsQ0FBQ3NCLE9BQVosQ0FBb0JwQixHQUFwQixDQUF5QixDQUFDcUIsR0FBRCxDQUFNQyxFQUFOLEdBQWEsMEJBQ3BDLEdBQUlDLENBQUFBLEdBQUcsMkJBQUdELEVBQUUsQ0FBQ0EsRUFBSCxDQUFNLFFBQU4sQ0FBSCxDQUFQLENBQ0EsR0FBSVksQ0FBQUEsT0FBTywyQkFBRyxDQUFFTCxFQUFFLENBQUVHLEtBQU4sQ0FBSCxDQUFYLENBRm9DLHlCQUlwQ1QsR0FBRyxDQUFDQyxVQUFKLENBQWUsVUFBZixFQUEyQlcsT0FBM0IsQ0FBbUNELE9BQW5DLENBQTRDLFNBQVNiLEdBQVQsQ0FBY0ssTUFBZCxDQUFzQixtREFDaEVKLEVBQUUsQ0FBQ0ssS0FBSCxHQURnRSx5QkFFaEUsR0FBSU4sR0FBSixDQUFTLENBQ1A7QUFETyw0QkFFUixDQUZELElBR0sseURBQUlLLE1BQU0sRUFBSSxJQUFkLENBQW9CLHNEQUN2Qm5CLEdBQUcsQ0FBQ0wsSUFBSixDQUFTd0IsTUFBVCxFQUFnQjtBQUNqQixDQUZJLElBR0Esc0RBQ0huQixHQUFHLENBQUNNLFVBQUosQ0FBZSxHQUFmLEVBQ0QsRUFDRixDQVhELEVBWUQsQ0FoQkQsRUFpQkQsQ0FDRixDQXpCRCxFLHlCQTJCQWxCLEdBQUcsQ0FBQ00sR0FBSixDQUFRLFNBQVVLLEdBQVYsQ0FBZUMsR0FBZixDQUFvQixtREFDMUI7QUFDQUEsR0FBRyxDQUFDb0MsSUFBSixDQUFTLHdCQUFULENBQW1DLEdBQW5DLEVBQ0QsQ0FIRCxFLHlCQU1BQyxNQUFNLENBQUNDLE9BQVAsQ0FBaUJqRCxNQUFqQixDQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGV4cHJlc3MgPSByZXF1aXJlKCdleHByZXNzJyk7XG5jb25zdCBhcHAgPSBleHByZXNzKCk7XG52YXIgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcbmNvbnN0IHtNb25nb0NsaWVudH0gPSByZXF1aXJlKCdtb25nb2RiJyk7XG5sZXQgc2FuaXRpemUgPSByZXF1aXJlKCdtb25nby1zYW5pdGl6ZScpO1xubGV0IHVybCA9IFwibW9uZ29kYjovL2xvY2FsaG9zdDoyNzAxNy9cIjtcblxuYXBwLnVzZShleHByZXNzLmpzb24oKSk7XG5hcHAudXNlKGV4cHJlc3MudXJsZW5jb2RlZCh7IGV4dGVuZGVkOiBmYWxzZSB9KSk7XG5cblxucm91dGVyLmFsbCgnL21lc3NhZ2VzJywgZnVuY3Rpb24ocmVxLCByZXMsIG5leHQpIHtcbiAgY29uc29sZS5sb2cocmVxLmJvZHkpXG4gIGlmKHJlcS5tZXRob2QgPT0gXCJQT1NUXCIgfHwgcmVxLm1ldGhvZCA9PSBcIkdFVFwiKSB7XG4gICAgLy9Lb2xsYSBvbSBnZXQgaGFyIGVuIGJvZHk/XG4gICAgaWYgKHJlcS5tZXRob2QgPT0gXCJHRVRcIiAmJiByZXEuYm9keSA9PSB7fSkgeyAvL0h1ciBmdW5rYXIgZGV0IGjDpHI/Pz9cbiAgICAgIGNvbnNvbGUubG9nKFwiZmFpbGVkIGdldCBhbGxcIilcbiAgICAgIHJlcy5zZW5kU3RhdHVzKDQwNSlcbiAgICB9XG4gICAgbmV4dCgpO1xuICB9IGVsc2Uge1xuICAgIC8vY29uc29sZS5sb2cocmVxLm1ldGhvZClcbiAgICBjb25zb2xlLmxvZyhcImFub3RoZXIgZmFpbGVkIGdldCBhbGxcIilcbiAgICByZXMuc2VuZFN0YXR1cyg0MDUpXG4gIH1cbn0pXG5cbnJvdXRlci5hbGwoJy9tZXNzYWdlcy86aWQnLCBmdW5jdGlvbihyZXEsIHJlcywgbmV4dCkge1xuICAvL2NvbnNvbGUubG9nKFwiMVwiKVxuICBpZihyZXEubWV0aG9kID09IFwiUEFUQ0hcIiB8fCByZXEubWV0aG9kID09IFwiR0VUXCIpIHtcbiAgICBuZXh0KCk7XG4gIH0gZWxzZSB7XG4gICAgcmVzLnNlbmRTdGF0dXMoNDA1KVxuICB9XG59KVxuXG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vL1NhdmUgb25lXG5cbnJvdXRlci5wb3N0KCcvbWVzc2FnZXMnLCAocmVxLCByZXMpID0+IHtcbiAgY29uc29sZS5sb2cocmVxLmJvZHkpXG4gIGlmICh2YWxpZGF0ZU1zZyhyZXEuYm9keSkpIHtcbiAgICBtc2cgPSBzYW5pdGl6ZShyZXEuYm9keSlcbiAgICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoLzxzY3JpcHQ+LykgIC8vaW5qZWN0aW9uP1xuICAgIGlmICghcmVnZXgudGVzdChtc2cpKSB7XG4gICAgICBNb25nb0NsaWVudC5jb25uZWN0KHVybCwgKGVyciwgZGIpID0+IHtcbiAgICAgICAgbGV0IGRibyA9IGRiLmRiKFwidGRwMDEzXCIpO1xuICAgICAgICBkYm8uY29sbGVjdGlvbignbWVzc2FnZXMnKS5pbnNlcnRPbmUobXNnLCBmdW5jdGlvbihlcnIsIHJlc3VsdCkge1xuICAgICAgICAgIGlmIChlcnIpIHt9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBkYi5jbG9zZSgpO1xuICAgICAgICAgICAgcmVzLnNlbmRTdGF0dXMoMjAwKVxuICAgICAgICAgIH1cblxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHJlcy5zZW5kU3RhdHVzKDUwMClcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgcmVzLnNlbmRTdGF0dXMoNTAwKVxuICB9XG4gIFxufSlcblxuZnVuY3Rpb24gdmFsaWRhdGVNc2coYm9keSkge1xuXG4gIGlmIChib2R5Lm1zZy5sZW5ndGggPT09IDAgfHwgYm9keS5tc2cubGVuZ3RoID4gMTQwKSB7IHJldHVybiBmYWxzZSB9XG4gIGlmICghKHR5cGVvZihib2R5LmlkKSA9PSBcInN0cmluZ1wiKSkgICAgICAgICAgICAgICAgICAgICAgICB7IHJldHVybiBmYWxzZSB9XG4gIGlmICh0eXBlb2YoYm9keS5zdGF0ZSkgIT09IFwiYm9vbGVhblwiKSAgICAgICAgICAgICAgICAgeyByZXR1cm4gZmFsc2UgfVxuICByZXR1cm4gdHJ1ZVxufVxuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy9NYXJrIHJlYWRcbnJvdXRlci5wYXRjaCgoJy9tZXNzYWdlcy86aWQnKSwgKHJlcSwgcmVzKSA9PiB7XG4gIGNvbnNvbGUubG9nKFwiSEVSRVwiKVxuICBsZXQgbXNnSWQgPSBzYW5pdGl6ZShyZXEucGFyYW1zLmlkKVxuICAvL2NvbnNvbGUubG9nKFwiaW4gcGF0Y2ggZnVuY3Rpb24gd2l0aCB2YWx1ZSBcIiArIG1zZ0lkKVxuXG4gIGlmICh0eXBlb2YobXNnSWQpICE9IFwic3RyaW5nXCIpIHtcbiAgICByZXMuc2VuZFN0YXR1cyg0MDApXG5cbiAgfSBlbHNlIHtcbiAgICBNb25nb0NsaWVudC5jb25uZWN0KHVybCwgKGVyciwgZGIpID0+IHtcbiAgICAgIGxldCBkYm8gPSBkYi5kYihcInRkcDAxM1wiKTtcbiAgICAgIGxldCBteXF1ZXJ5ID0geyBpZDogbXNnSWQgfTtcbiAgICAgIFxuICAgICAgZGJvLmNvbGxlY3Rpb24oXCJtZXNzYWdlc1wiKS5maW5kT25lKG15cXVlcnksIGZ1bmN0aW9uKGVyciwgcmVzdWx0KSB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICByZXMuc2VuZFN0YXR1cyg1MDApXG4gICAgICAgIH0gXG4gICAgICAgIGVsc2UgaWYgKHJlc3VsdCAhPSBudWxsKSB7XG4gICAgICAgICAgLy9JZiB3ZSBmaW5kIGEgcmVzdWx0XG4gICAgICAgICAgbGV0IG5ld3ZhbHVlcyA9IHsgJHNldDoge3N0YXRlOiAhKHJlc3VsdC5zdGF0ZSl9IH07XG4gICAgICAgICAgXG4gICAgICAgICAgZGJvLmNvbGxlY3Rpb24oXCJtZXNzYWdlc1wiKS51cGRhdGVPbmUobXlxdWVyeSwgbmV3dmFsdWVzLCBmdW5jdGlvbihlcnIsIHJlc3VsdDIpIHtcbiAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgZGIuY2xvc2UoKTtcbiAgICAgICAgICAgICAgcmVzLnNlbmRTdGF0dXMoNTAwKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIGRiLmNsb3NlKClcbiAgICAgICAgICAgICAgcmVzLnNlbmRTdGF0dXMoMjAwKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9IFxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAvL0lmIHdlIGRvbnQgZmluZCBhIHJlc3VsdFxuICAgICAgICAgIHJlcy5zZW5kU3RhdHVzKDUwMClcbiAgICAgICAgICBkYi5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIFxuICAgIH0pO1xuICB9XG59KVxuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy9HZXQgYWxsXG5yb3V0ZXIuZ2V0KCgnL21lc3NhZ2VzJyksIChyZXEsIHJlcykgPT4ge1xuXG4gIE1vbmdvQ2xpZW50LmNvbm5lY3QodXJsLCAoZXJyLCBkYikgPT4ge1xuICAgIGxldCBkYm8gPSBkYi5kYihcInRkcDAxM1wiKTtcblxuICAgIGRiby5jb2xsZWN0aW9uKCdtZXNzYWdlcycpLmZpbmQoKS50b0FycmF5KGZ1bmN0aW9uKGVyciwgcmVzdWx0KSB7XG4gICAgICBkYi5jbG9zZSgpO1xuICAgICAgaWYgKGVycikge1xuICAgICAgICAvL2NvbnNvbGUubG9nKGVycilcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKHJlc3VsdCAhPSBudWxsKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdClcbiAgICAgICAgcmVzLnNlbmQocmVzdWx0KVxuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHJlcy5zZW5kU3RhdHVzKDUwMClcbiAgICAgIH1cbiAgICB9KVxuICAgIFxuICB9KVxufSlcblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIEdldCBvbmVcbnJvdXRlci5nZXQoKCcvbWVzc2FnZXMvOmlkJyksIChyZXEsIHJlcykgPT4ge1xuICBsZXQgbXNnSWQgPSBzYW5pdGl6ZShyZXEucGFyYW1zLmlkKVxuICBjb25zb2xlLmxvZyhcIklEOiBcIiArIG1zZ0lkKVxuICBpZiAodHlwZW9mKG1zZ0lkKSAhPSBcInN0cmluZ1wiKSB7XG4gICAgcmVzLnNlbmRTdGF0dXMoNDAwKVxuICB9IGVsc2Uge1xuXG4gICAgTW9uZ29DbGllbnQuY29ubmVjdCh1cmwsIChlcnIsIGRiKSA9PiB7XG4gICAgICBsZXQgZGJvID0gZGIuZGIoXCJ0ZHAwMTNcIik7XG4gICAgICBsZXQgbXlxdWVyeSA9IHsgaWQ6IG1zZ0lkIH07XG5cbiAgICAgIGRiby5jb2xsZWN0aW9uKFwibWVzc2FnZXNcIikuZmluZE9uZShteXF1ZXJ5LCBmdW5jdGlvbihlcnIsIHJlc3VsdCkge1xuICAgICAgICBkYi5jbG9zZSgpO1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgLy9jb25zb2xlLmxvZyhlcnIpXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocmVzdWx0ICE9IG51bGwpIHtcbiAgICAgICAgICByZXMuanNvbihyZXN1bHQpLy8uanNvbihyZXN1bHQpXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgcmVzLnNlbmRTdGF0dXMoNTAwKVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxufSlcblxuYXBwLnVzZShmdW5jdGlvbiAocmVxLCByZXMpIHtcbiAgLy9jb25zb2xlLmxvZyhcImZvdW5kIGl0XCIpXG4gIHJlcy5zZW5kKFwiU29ycnkgY2FuJ3QgZmluZCB0aGF0IVwiLCA0MDQpXG59KVxuXG5cbm1vZHVsZS5leHBvcnRzID0gcm91dGVyO1xuXG5cbi8qYW52w6RuZCBhc3lua3JvbmEgYW5yb3AgZsO2ciBhdHQgaMOkbXRhIG9jaCBsYWdyYSBkYXRhLiBcbkthbiB0YSBpbiBlbiByZXNvbHZlIG9jaCByZWplY3QgZnVua3Rpb24uIFxuTWVkIGRldHRhIGthbiB2aSBza2lja2EgcsOkdHQgZmVsbWVkZGVsYW5kZW4uXG5lbiBiYWNrZW5kIGZpbCBzb20gaGFudGVyYXIgbG9naWtcbmVuIHRlc3RmaWwgc29tIHJlcHJlc2VudGVyYXIga2xpZW50LWxvZ2lrZW4gXG4oYWxsdHPDpSBvbSB2aSBrbGlja2FyIHDDpSBlbiBrbmFwcCBrb21tZXIgbWVkZGVsYW5kZSB4XG5za2lja2FzIHQuZXgpKi9cbiJdfQ==